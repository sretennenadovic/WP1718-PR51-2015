<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/balloon-css/0.5.0/balloon.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>

        /**********************************************************************************************************************/
        /*Padajuci meni kopirao sam sa w3*/
        .dropbtn {
            background-color: #4CAF50;
            color: white;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        /* The container <div> - needed to position the dropdown content */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .homeButton {
            position: relative;
            display: inline-block;
            top: -11px;
        }
        
        .homeButtonD {
            position: relative;
            display: inline-block;
            margin-right:12px;
            top: 0%;
        }

        .addButton {
            position: relative;
            display: inline-block;
            top: 0px;
            margin-left: 12px;
        }

        .searchButton {
            position: relative;
            display: inline-block;
            top: 0px;
            margin-left: 12px;
        }
        .searchButtonK {
            position: relative;
            display: inline-block;
            top: -20px;
            margin-left: 0px;
        }

        .positionButton{
            position:relative;
            display:inline-block;
            top:-15px;
            margin-left:12px;
        }
        /* Dropdown Content (Hidden by Default) */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            top: 55px;
        }

            /* Links inside the dropdown */
            .dropdown-content a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                display: block;
            }

                /* Change color of dropdown links on hover */
                .dropdown-content a:hover {
                    background-color: #eeff84;
                }

        /* Show the dropdown menu on hover */
        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* Change the background color of the dropdown button when the dropdown content is shown */
        .dropdown:hover .dropbtn {
            background-color: #3e8e41;
        }

        /*kraj padajuci meni*/
        /**********************************************************************************************************************/

        th {
            text-align: center;
        }

        td {
            padding-left: 4px;
            padding-right: 4px;
        }

        .izmenaVoznje {
            margin-left: 5%;
            margin-top: 3%;
        }

        footer {
            background-color: #f2f2f2;
            padding: 25px;
        }

        /*samo klasa za nav bar visina i boja*/
        .nova {
            background-color: #ffd700;
            height: 55px;
        }

        /*div za komentar kad musterija otkaze*/
        .komentar{
            margin-left:5%;
            margin-top:3%;
        }

        /*vozac menja lokaciju*/
        .lokacijaClass{
            margin-left:5%;
            margin-top:3%;
        }
        /*za sliku (logo) taksija*/
        img {
            height: 500px;
            width: 600px;
        }

        /*div*/
        #wrapper {
            overflow: auto;
        }

        /*div takodje za naslov koji pise u nav baru*/
        #d1, #d1v, #d1d {
            position: absolute;
            right: 45%;
            top: 6px;
            font-size: 30px;
            font-weight: bold;
        }

        /*logo na sredini sto se nalazi*/
        #soloPic, #soloPicd, #soloPicv {
            position: absolute;
            left: 50%;
            top: 50%;
            margin-left: -300px;
            margin-top:-250px;
            opacity: 0.4;
        }

        /*div*/
        #zaprofil, #zaprofild {
            position: absolute;
            top: 80px;
            left: 80px;
            font-size: large;
        }

        #zaprofilv {
            position: absolute;
            top: 80px;
            left: 80px;
            font-size: medium;
        }
        /*div*/
        #zaizmenu, #zaizmenud, #zaizmenuv, #dodavanjeVozaca {
            position: absolute;
            top: 80px;
            left: 80px;
        }

        /*font u bodyiu*/
        body {
            font-size: 18px;
        }

        /*font u nav tagu*/
        nav {
            font-size: 20px;
        }

        /*boja zaglavlja tabela sa voznjama*/
        .boja th {
            background-color: #edea5a;
        }


        .voznje {
            width: 90%;
            margin-top: 5%;
            margin-left: 5%;
            position: absolute;
            font-size: 13px;
            text-align: center;
        }

        .koloneVoznje {
            min-width: 15%;
        }

        tr:hover {
            background-color: #eeff84;
        }

        tr td:hover {
            background-color: #edea5a;
        }


        input {
            border: 2px solid #aaa;
            border-radius: 4px;
            outline: none;
            transition: 0.3s;
        }

            button:focus, input:focus {
                border-color: #ffd700;
                box-shadow: 0 0 8px 0 #ffd700;
            }

        button {
            border-radius: 8px;
        }



        
    </style>
    <script src="Scripts/jquery-1.10.2.js"></script>
    <script type="text/javascript">


        function vratiStatusVoznje(id) {
            switch (id) {
                case 0: return "Kreirana";
                case 1: return "Formirana";
                case 2: return "Obradjena";
                case 3: return "Prihvaćena";
                case 4: return "Otkazana";
                case 5: return "Neuspešna";
                case 6: return "Uspešna";
                case 7: return "Utoku";
            }
        }

        function vratiVozilo(id) {
            switch (id) {
                case 0: return "Putnicki";
                case 1: return "Kombi";
                case 2: return "Svejedno";
            }
        }

        function proveriUlogovanog() {
            let korisnickoIme = localStorage.getItem("Ulogovan");
            if (korisnickoIme == "") {
                $(location).attr('href', 'index.html');
            }
        }

        proveriUlogovanog();

        function uporedi(atr1, atr2) {
            const atr3 = [];

            atr1.forEach((e1) => atr2.forEach((e2) =>
            {
                if (e1 == e2.Vozac) {
                    atr3.push(e2)
                }
                }
        
        ));
                return atr3;
        }

        function uporediMusterija(atr1, atr2) {
            const atr3 = [];

            atr1.forEach((e1) => atr2.forEach((e2) => {
                if (e1 == e2.Musterija) {
                    atr3.push(e2)
                }
            }

            ));
            return atr3;
        }

        $(document).ready(function () {
            $('#vozac').hide();
            $('#dispecer').hide();
            $('#korisnik').hide();


            //------------------------------------------------------------------
            //pomocne promenljive
            let korisnik;
            let korisnickoIme = localStorage.getItem("Ulogovan");

            let korisnickiId;
            let idVoznja;

            //pomocu korisnickog imena yahtevam preko post metode od servera da mi vrati celog korisnika (dole u ajaxu nastavak)
            let Korisnik = {
                KorisnickoIme: `${korisnickoIme}`
            };

            $.ajax({
                type: 'GET',
                url: '/api/LogIn' ,
                data: { KorisnickoIme: `${localStorage.getItem("Ulogovan")}` },
                contentType: 'application/json;charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data != null) {
                        korisnik = data;// MORAM IZBACITI JER SVAKI PUT IDE GET
                        korisnickiId = data.Id;
                        //prikaz odredjenog diva za odredjenu ulogu korisnika
                        if (korisnik.Uloga == 0) {
                            $('#vozac').hide();
                            $('#dispecer').hide();
                            $('#korisnik').show();
                            //zahtev za voznjama ako je korisnik musterija
                            $.ajax({
                                type: 'GET',
                                url: '/api/Voznja',
                                //data: JSON.stringify(korisnik.Id),
                                contentType: 'application/json;charset=utf-8',
                                dataType: 'json',
                                success: function (data) {

                                    let s = '';
                                    s += '<div id="voznje" style="font-size:14px">';
                                    s += '<h3 style="margin-left:44%;position:absolute;"><b>Moje vožnje</b></h3>';
                                    s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Dispečer</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';


                                    for (let i = 0; i < data.length; i++) {
                                        if (data[i].Musterija == localStorage.getItem("Ulogovan")) {
                                            s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                            if (data[i].Dispecer == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Dispecer + '</td>');
                                            }

                                            if (data[i].Vozac == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Vozac + '</td>');
                                            }

                                            s+= ('<td>'+data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                            switch (data[i].Automobil) {
                                                case 0:
                                                    s += "Putnički";
                                                    break;
                                                case 1:
                                                    s += "Kombi";
                                                    break;
                                                case 2:
                                                    s += "Svejedno";
                                            }

                                            if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                                s += ("<td>/" + "</td>");
                                            }
                                            else {
                                                s += ("<td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                            }

                                            if (data[i].Iznos != "0") {
                                                s += ("<td>" + data[i].Iznos + "</td>");
                                            } else {
                                                s += ("<td>/</td>");
                                            }

                                            s += ('<td><textarea rows="5" cols="30" disabled>');

                                            if (data[i].Komentar.Opis == "") {
                                                s += ("Komentar nije dodat!" + "</textarea ></td >");
                                            } else {
                                                s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                            }

                                            s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                            if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                                s += (`<input type="button" value="Odustani" id="odustani" class="obtn" name=${data[i].IdVoznje} /><br /><br />`);
                                                s += (`<input type="button" value="  Izmeni " id="izmeniV" class="ibtn" name=${data[i].IdVoznje} />`);
                                            } else if (vratiStatusVoznje(data[i].StatusVoznje) == "Uspešna") {
                                                s += (`<input type="button" value=" Komentar " id="dodajKomentarUspesna" class="kombtn" name=${data[i].IdVoznje} />`);
                                            } else {
                                                s += ("Nedostupne");
                                            }
                                            s += (`</td></tr>`)
                                        }
                                    }

                                    s += '</table></div>';
                                    $('#glavni').append(s);
                                }
                            })
                        } else if (korisnik.Uloga == 1) {
                            $('#vozac').hide();
                            $('#korisnik').hide();
                            $('#dispecer').show();
                            $.ajax({
                                type: 'GET',
                                url: '/api/Voznja',
                                //data: JSON.stringify(korisnik.Id),
                                contentType: 'application/json;charset=utf-8',
                                dataType: 'json',
                                success: function (data) {

                                    let s = '';
                                    s += '<div id="voznjeD" style="font-size:14px">';
                                    s += '<h3 style="margin-left:44%;position:absolute;"><b>Moje vožnje</b></h3>';
                                    s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';


                                    for (let i = 0; i < data.length; i++) {
                                        if (data[i].Dispecer == localStorage.getItem("Ulogovan")) {
                                            s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                            if (data[i].Musterija == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Musterija + '</td>');
                                            }

                                            if (data[i].Vozac == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Vozac + '</td>');
                                            }

                                            s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                            switch (data[i].Automobil) {
                                                case 0:
                                                    s += "Putnički";
                                                    break;
                                                case 1:
                                                    s += "Kombi";
                                                    break;
                                                case 2:
                                                    s += "Svejedno";
                                            }

                                            if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                                s += ("</td><td>/" + "</td>");
                                            }
                                            else {
                                                s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                            }

                                            if (data[i].Iznos != "0") {
                                                s += ("<td>" + data[i].Iznos + "</td>");
                                            } else {
                                                s += ("<td>/</td>");
                                            }

                                            s += ('<td><textarea rows="5" cols="30" disabled>');

                                            if (data[i].Komentar.Opis == "") {
                                                s += ("Komentar nije dodat!" + "</textarea ></td >");
                                            } else {
                                                s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                            }

                                            s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                            if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                                s += (`<input type="button" value="Obradi" id="obradi" class="obradibtn" name=${data[i].IdVoznje} /><br /><br />`);
                                            } else {
                                                s += ("Nedostupne");
                                            }
                                            s += (`</td></tr>`)
                                        }
                                    }

                                    s += '</table>';
                                    $('#glavni2').append(s);
                                }
                            })
                        } else {
                            $('#korisnik').hide();
                            $('#dispecer').hide();
                            $('#vozac').show();

                            $.ajax({
                                type: 'GET',
                                url: '/api/Voznja',
                                //data: JSON.stringify(korisnik.Id),
                                contentType: 'application/json;charset=utf-8',
                                dataType: 'json',
                                success: function (data) {

                                    let s = '';
                                    s += ' <div id="voznjeV" style="font-size:14px">';
                                    s += '<h3 style="margin-left:44%;position:absolute;"><b>Moje vožnje</b></h3>';
                                    s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Dispečer</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';

                                    for (let i = 0; i < data.length; i++) {
                                        if (data[i].Vozac == localStorage.getItem("Ulogovan")) {
                                            s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                            if (data[i].Musterija == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Musterija + '</td>');
                                            }

                                            if (data[i].Dispecer == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Dispecer + '</td>');
                                            }

                                            s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                            switch (data[i].Automobil) {
                                                case 0:
                                                    s += "Putnički";
                                                    break;
                                                case 1:
                                                    s += "Kombi";
                                                    break;
                                                case 2:
                                                    s += "Svejedno";
                                            }

                                            if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                                s += ("</td><td>/" + "</td>");
                                            }
                                            else {
                                                s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                            }

                                            if (data[i].Iznos != "0") {
                                                s += ("<td>" + data[i].Iznos + "</td>");
                                            } else {
                                                s += ("<td>/</td>");
                                            }

                                            s += ('<td><textarea rows="5" cols="30" disabled>');

                                            if (data[i].Komentar.Opis == "") {
                                                s += ("Komentar nije dodat!" + "</textarea ></td >");
                                            } else {
                                                s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                            }

                                            s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                            if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana" && data[i].Zauzet != "DA") {//ovo ovde cu ostaviti ne steti ali nije ispravno!
                                                s += (`<input type="button" value="Prihvati" id="Prihvati" class="prihvatibtn" name=${data[i].IdVoznje} /><br /><br />`);
                                            } else if (vratiStatusVoznje(data[i].StatusVoznje) == "Prihvaćena" || vratiStatusVoznje(data[i].StatusVoznje) == "Obradjena" || vratiStatusVoznje(data[i].StatusVoznje) == "Formirana") {
                                                s += (`<input type="button" value=" Uspešna  " id="uspesna" class="uspesnabtn" name=${data[i].IdVoznje} /><br /><br />`);
                                                s += (`<input type="button" value="Neuspešna" id="neuspesna" class="neuspesnabtn" name=${data[i].IdVoznje} /><br />`);
                                            } else {
                                                s += ("Nedostupne");
                                            }
                                            s += (`</td></tr>`);
                                        }
                                    }

                                    s += '</table></div>';
                                    $('#glavni3').append(s);
                                }
                            })
                        }
                    }
                }
            })


        /*    $.ajax({
                type: 'POST',
                url: '/api/UserVozac',
                data: JSON.stringify(Korisnik),
                contentType: 'application/json;charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data != null) {
                        korisnik = data;
                        korisnickiId = data.Id;
                        //prikaz odredjenog diva za odredjenu ulogu korisnika
                        if (korisnik.Uloga == 0) {
                            $('#vozac').hide();
                            $('#dispecer').hide();
                            $('#korisnik').show();
                            $('#zaprofil').hide();
                            $('#zaizmenu').hide();
                            $('#divNovaVoznja').hide();
                        } else if (korisnik.Uloga == 1) {
                            $('#vozac').hide();
                            $('#korisnik').hide();
                            $('#dispecer').show();
                            $('#zaprofild').hide();
                            $('#zaizmenud').hide();
                            $('#dodavanjeVozaca').hide();

                        } else {
                            $('#korisnik').hide();
                            $('#dispecer').hide();
                            $('#vozac').show();
                            $('#zaprofilv').hide();
                            $('#zaizmenuv').hide();
                        }
                    }
                }

            })*/


            /*pri kliku na link profil*/
            $('#profil').click(function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Registration',

                    data: { KorisnickoIme: `${localStorage.getItem("Ulogovan")}` },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        korisnik = data;
                        korisnickiId = data.Id;
                        //prikaz odredjenog diva za odredjenu ulogu korisnika
                        if (korisnik.Uloga == 0) {
                            $('#vozac').hide();
                            $('#dispecer').hide();
                            $('#korisnik').show();
                            $('#zaprofil').hide();
                            $('#zaizmenu').hide();
                            $('#divNovaVoznja').hide();
                        } else if (korisnik.Uloga == 1) {
                            $('#vozac').hide();
                            $('#korisnik').hide();
                            $('#dispecer').show();
                            $('#zaprofild').hide();
                            $('#zaizmenud').hide();
                        } else {
                            $('#korisnik').hide();
                            $('#dispecer').hide();
                            $('#vozac').show();
                        }
                        $('#glavni').hide();

                        let s = '';

                        s += '<div id="zaprofil">';
                        s += '<h2>Korisnički profil</h2>';
                        s += '<hr />';
                        s += '<table>';
                        s += '<tr><th>Korisničko ime:</th><td id="1"></td></tr>';
                        s += '<tr><th>Lozinka:</th><td id="2"></td></tr>';
                        s += '<tr><th>Ime:</th><td id="3"></td></tr>';
                        s += '<tr><th>Prezime:</th><td id="4"></td></tr>';
                        s += '<tr><th>JMBG:</th><td id="5"></td></tr>';
                        s += '<tr><th>Pol:</th><td id="6"></td></tr>';
                        s += '<tr><th>Kontakt Telefon:</th><td id="7"></td></tr>';
                        s += '<tr><th>Email:</th><td id="8"></td></tr>';
                        s += '<tr><th>Uloga:</th><td id="9"></td></tr>';
                        s += '</table>';
                        s += '</div>';
                        $('#glavni').html(s);
                        
                        $('#1').text(korisnik.KorisnickoIme);
                        $('#2').text(korisnik.Lozinka);
                        $('#3').text(korisnik.Ime);
                        $('#4').text(korisnik.Prezime);
                        $('#5').text(korisnik.JMBG);
                        if (korisnik.Pol == 0) {
                            $('#6').text("Muški");
                        } else {
                            $('#6').text("Ženski");
                        }
                        $('#7').text(korisnik.KontaktTelefon);
                        $('#8').text(korisnik.Email);
                        $('#9').text('Mušterija');
                        $('#glavni').fadeIn(500);
                    }
                })
            })



            $('#profild').click(function () {
                //------------------------------------------------------------------------------------------------------------
                //moram da ponavljam je r kada uradim izmenu, mora opet novo da mi povuce
                $.ajax({
                    type: 'GET',
                    url: '/api/Dispecer',

                    data: { KorisnickoIme: `${localStorage.getItem("Ulogovan")}` },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        korisnik = data;
                        korisnickiId = data.Id;
                        //prikaz odredjenog diva za odredjenu ulogu korisnika
                        if (korisnik.Uloga == 0) {
                            $('#vozac').hide();
                            $('#dispecer').hide();
                            $('#korisnik').show();
                            $('#zaprofil').hide();
                            $('#zaizmenu').hide();
                        } else if (korisnik.Uloga == 1) {
                            $('#vozac').hide();
                            $('#korisnik').hide();
                            $('#dispecer').show();
                            $('#zaprofild').hide();
                            $('#zaizmenud').hide();
                            $('#dodavanjeVozaca').hide();
                        } else {
                            $('#korisnik').hide();
                            $('#dispecer').hide();
                            $('#vozac').show();
                            $('#zaprofild').hide();
                            $('#zaizmenud').hide();
                        }
                        $('#glavni2').hide();

                        let s = '';
                        s += ' <div id="zaprofild">';
                        s += '   <h2>Korisnički profil</h2>';
                        s += '   <hr />';
                        s += '   <table>';
                        s += '      <tr><th>Korisničko ime:</th><td id="1d"></td></tr>';
                        s += '      <tr><th>Lozinka:</th><td id="2d"></td></tr>';
                        s += '     <tr><th>Ime:</th><td id="3d"></td></tr>';
                        s += '      <tr><th>Prezime:</th><td id="4d"></td></tr>';
                        s += '      <tr><th>JMBG:</th><td id="5d"></td></tr>';
                        s += '      <tr><th>Pol:</th><td id="6d"></td></tr>';
                        s += '       <tr><th>Kontakt Telefon:</th><td id="7d"></td></tr>';
                        s += '       <tr><th>Email:</th><td id="8d"></td></tr>';
                        s += '      <tr><th>Uloga:</th><td id="9d"></td></tr>';
                        s += '   </table>';
                        s += '  </div>';

                        $('#glavni2').html(s);
                        $('#1d').text(korisnik.KorisnickoIme);
                        $('#2d').text(korisnik.Lozinka);
                        $('#3d').text(korisnik.Ime);
                        $('#4d').text(korisnik.Prezime);
                        $('#5d').text(korisnik.JMBG);
                        if (korisnik.Pol == 0) {
                            $('#6d').text("Muški");
                        } else {
                            $('#6d').text("Ženski");
                        }
                        $('#7d').text(korisnik.KontaktTelefon);
                        $('#8d').text(korisnik.Email);
                        $('#9d').text('Dispečer');
                        $('#glavni2').fadeIn(500);
                    }
                })
            })

            $('#profilv').click(function () {
                //------------------------------------------------------------------------------------------------------------
                //moram da ponavljam je r kada uradim izmenu, mora opet novo da mi povuce
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',

                    data: { KorisnickoIme: `${localStorage.getItem("Ulogovan")}` },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        korisnik = data;
                        korisnickiId = data.Id;
                        //prikaz odredjenog diva za odredjenu ulogu korisnika
                        if (korisnik.Uloga == 0) {
                            $('#vozac').hide();
                            $('#dispecer').hide();
                            $('#korisnik').show();
                            $('#zaprofil').hide();
                            $('#zaizmenu').hide();
                        } else if (korisnik.Uloga == 1) {
                            $('#vozac').hide();
                            $('#korisnik').hide();
                            $('#dispecer').show();
                            $('#zaprofild').hide();
                            $('#zaizmenud').hide();
                        } else {
                            $('#korisnik').hide();
                            $('#dispecer').hide();
                            $('#vozac').show();
                            $('#zaprofilv').hide();
                            $('#zaizmenuv').hide();
                        }
                        $('#glavni3').hide();

                        let s = '';

                        s += ' <div id="zaprofilv">';
                        s += '   <h2>Korisnički profil</h2>';
                        s += '  <hr />';
                        s += '  <table>';
                        s += '     <tr><th>Korisničko ime:</th><td id="1v"></td></tr>';
                        s += '     <tr><th>Lozinka:</th><td id="2v"></td></tr>';
                        s += '     <tr><th>Ime:</th><td id="3v"></td></tr>';
                        s += '     <tr><th>Prezime:</th><td id="4v"></td></tr>';
                        s += '     <tr><th>JMBG:</th><td id="5v"></td></tr>';
                        s += '     <tr><th>Pol:</th><td id="6v"></td></tr>';
                        s += '     <tr><th>Kontakt Telefon:</th><td id="7v"></td></tr>';
                        s += '     <tr><th>Email:</th><td id="8v"></td></tr>';
                        s += '     <tr><th>Uloga:</th><td id="19v"></td></tr>';
                        s += '     <tr><th>Lokacija X:</th><td id="9v"></td></tr>';
                        s += '      <tr><th>Lokacija Y:</th><td id="10v"></td></tr>';
                        s += '      <tr><th>Ulica i broj:</th><td id="11v"></td></tr>';
                        s += '      <tr><th>Naseljeno mesto:</th><td id="12v"></td></tr>';
                        s += '     <tr><th>Pozivni broj:</th><td id="13v"></td></tr>';
                        s += '     <tr><th>Id vozača:</th><td id="14v"></td></tr>';
                        s += '     <tr><th>Godište automobila:</th><td id="15v"></td></tr>';
                        s += '     <tr><th>Registarske oznake:</th><td id="16v"></td></tr>';
                        s += '      <tr><th>Taxi broj:</th><td id="17v"></td></tr>';
                        s += '      <tr><th>Vrsta vozila:</th><td id="18v"></td></tr>';
                        s += '      <tr><th>Zauzetost:</th><td id="20v"></td></tr>';
                        s += ' </table > ';
                        s += ' </div > ';
                        $('#glavni3').html(s);

                        $('#1v').text(korisnik.KorisnickoIme);
                        $('#2v').text(korisnik.Lozinka);
                        $('#3v').text(korisnik.Ime);
                        $('#4v').text(korisnik.Prezime);
                        $('#5v').text(korisnik.JMBG);
                        if (korisnik.Pol == 0) {
                            $('#6v').text("Muški");
                        } else {
                            $('#6v').text("Ženski");
                        }
                        $('#7v').text(korisnik.KontaktTelefon);
                        $('#8v').text(korisnik.Email);
                        $('#19v').text('Vozač');
                        $('#9v').text(korisnik.Lokacija.X);
                        $('#10v').text(korisnik.Lokacija.Y);
                        $('#11v').text(korisnik.Lokacija.Adresa.UlicaBroj);
                        $('#12v').text(korisnik.Lokacija.Adresa.NaseljenoMesto);
                        $('#13v').text(korisnik.Lokacija.Adresa.PozivniBroj);
                        $('#14v').text(korisnik.Automobil.IdVozaca);
                        $('#15v').text(korisnik.Automobil.GodisteAutomobila);
                        $('#16v').text(korisnik.Automobil.BrojRegistarskeOznake);
                        $('#17v').text(korisnik.Automobil.BrojTaksiVozila);
                        if (korisnik.Automobil.TipAutomobila == 0) {
                            $('#18v').text("Putnički");
                        } else {
                            $('#18v').text("Kombi");
                        }

                        if (korisnik.Zauzet == "DA") {
                            $('#20v').text("Zauzet");
                        } else if (korisnik.Zauzet == "NE") {
                            $('#20v').text("Slobodan");
                        }
                        $('#glavni3').fadeIn(500);
                    }
                })
            })

            /*pri kliku na link izmeni*/
            $('#izmenid').click(function () {
                $('#glavni2').hide();
                $('#dodavanjeVozaca').hide();

                let s = '';

                s += '<div id="zaizmenud">';
                s += '  <table>';
                s += '     <tr><th>Korisničko ime:</th><td><input type="text" name="KorisnickoImed" id="KorisnickoImed" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Lozinka:</th><td><input type="text" name="Lozinkad" id="Lozinkad" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Ime:</th><td><input type="text" name="Imed" id="Imed" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Prezime:</th><td><input type="text" name="Prezimed" id="Prezimed" style="margin:5px" /></td></tr>';
                s += '      <tr><th>JMBG:</th><td><input type="text" name="JMBGd" id="JMBGd" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Pol:</th><td><label>Muški:&nbsp&nbsp</label><input type="radio" name="Pold" value="Muski" id="Pol1d" /><label>&nbsp&nbspŽenski:&nbsp&nbsp</label><input type="radio" value="Zenski" name="Pold" id="Pol2d" /></td></tr>';
                s += '     <tr><th>Kontakt Telefon:</th><td><input type="text" name="KontaktTelefond" id="KontaktTelefond" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Email:</th><td><input type="email" name="Emaild" id="Emaild" style="margin:5px" /></td></tr>';
                s += '     <tr><td colspan="2"><hr /></td></tr>';
                s += '    <tr><td colspan="2" align="right"><b><input type="button" value="Izmeni" id="izmenad" /></b></td></tr>';
                s += '  </table>';
                s += ' </div>';

                $('#glavni2').html(s);

                $('#KorisnickoImed').val(korisnik.KorisnickoIme);
                $('#Lozinkad').val(korisnik.Lozinka);
                $('#Imed').val(korisnik.Ime);
                $('#Prezimed').val(korisnik.Prezime);
                $('#JMBGd').val(korisnik.JMBG);
                if (korisnik.Pol == 0) {
                    $('#Pol1d').prop('checked', true);
                } else {
                    $('#Pol2d').prop('checked', true);
                }
                $('#KontaktTelefond').val(korisnik.KontaktTelefon);
                $('#Emaild').val(korisnik.Email);
                $('#glavni2').fadeIn(500);
            })

            $('#izmeni').click(function () {
                $('#glavni').hide();

                let s = '';
                s += '<div id="zaizmenu">';
                s += '  <table>';
                s += '      <tr><th>Korisničko ime:</th><td><input type="text" name="KorisnickoIme" id="KorisnickoIme" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Lozinka:</th><td><input type="text" name="Lozinka" id="Lozinka" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Ime:</th><td><input type="text" name="Ime" id="Ime" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Prezime:</th><td><input type="text" name="Prezime" id="Prezime" style="margin:5px" /></td></tr>';
                s += '     <tr><th>JMBG:</th><td><input type="text" name="JMBG" id="JMBG" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Pol:</th><td><label>Muški:&nbsp&nbsp</label><input type="radio" name="Pol" value="Muski" id="Pol1" /><label>&nbsp&nbspŽenski:&nbsp&nbsp</label><input type="radio" value="Zenski" name="Pol" id="Pol2" /></td></tr>';
                s += '     <tr><th>Kontakt Telefon:</th><td><input type="text" name="KontaktTelefon" id="KontaktTelefon" style="margin:5px" /></td></tr>';
                s += '     <tr><th>Email:</th><td><input type="email" name="Email" id="Email" style="margin:5px" /></td></tr>';
                s += '     <tr ><td colspan="2"><hr /></td></tr>';
                s += '     <tr><td colspan="2" align="right"><b><input type="button" value="Izmeni" id="izmena" /></b></td></tr';
                s += '  </table>';
                s += ' </div>';

                $('#glavni').html(s);

                $('#KorisnickoIme').val(korisnik.KorisnickoIme);
                $('#Lozinka').val(korisnik.Lozinka);
                $('#Ime').val(korisnik.Ime);
                $('#Prezime').val(korisnik.Prezime);
                $('#JMBG').val(korisnik.JMBG);
                if (korisnik.Pol == 0) {
                    $('#Pol1').prop('checked', true);
                } else {
                    $('#Pol2').prop('checked', true);
                }
                $('#KontaktTelefon').val(korisnik.KontaktTelefon);
                $('#Email').val(korisnik.Email);
                $('#glavni').fadeIn(500);
            })

            $('#izmeniv').click(function () {
                $('#glavni3').hide();

                let s = '';

                s += '<div id="zaizmenuv">';
                s += ' <table class="w3-small">';
                s += '      <tr><th>Korisničko ime:</th><td><input type="text" name="KorisnickoImev" id="KorisnickoImev" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Lozinka:</th><td><input type="text" name="Lozinkav" id="Lozinkav" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Ime:</th><td><input type="text" name="Imev" id="Imev" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Prezime:</th><td><input type="text" name="Prezimev" id="Prezimev" style="margin:5px" /></td></tr>';
                s += '     <tr><th>JMBG:</th><td><input type="text" name="JMBGv" id="JMBGv" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Pol:</th><td><label>Muški:&nbsp&nbsp</label><input type="radio" name="Polv" value="Muski" id="Pol1v" /><label>&nbsp&nbspŽenski:&nbsp&nbsp</label><input type="radio" value="Zenski" name="Polv" id="Pol2v" /></td></tr>';
                s += '      <tr><th>Kontakt Telefon:</th><td><input type="text" name="KontaktTelefonv" id="KontaktTelefonv" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Email:</th><td><input type="email" name="Emailv" id="Emailv" style="margin:5px" /></td></tr>';
                s += '       <tr><th>Godište automobila:</th><td><input type="text" name="GodisteAutomobila" id="GodisteAutomobila" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Registarske oznake:</th><td><input type="text" name="BrojRegistarskeOznake" id="BrojRegistarskeOznake" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Taxi broj:</th><td><input type="text" name="BrojTaksiVozila" id="BrojTaksiVozila" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Vrsta vozila:</th><td><label>Putnički:&nbsp&nbsp</label><input type="radio" name="TipAutomobila" value="Putnički" id="TipAutomobila1" /><label>&nbsp&nbspKombi:&nbsp&nbsp</label><input type="radio" value="Kombi" name="TipAutomobila" id="TipAutomobila2" /></td></tr>';
                s += '      <tr><td colspan="2"><hr /></td></tr>';
                s += '      <tr><td colspan="2" align="right"><b><input type="button" value="Izmeni" id="izmenav" /></b></td></tr>';
                s += '   </table>';
                s += ' </div>';

                $('#glavni3').html(s);

                $('#KorisnickoImev').val(korisnik.KorisnickoIme);
                $('#Lozinkav').val(korisnik.Lozinka);
                $('#Imev').val(korisnik.Ime);
                $('#Prezimev').val(korisnik.Prezime);
                $('#JMBGv').val(korisnik.JMBG);
                if (korisnik.Pol == 0) {
                    $('#Pol1v').prop('checked', true);
                } else {
                    $('#Pol2v').prop('checked', true);
                }
                $('#KontaktTelefonv').val(korisnik.KontaktTelefon);
                $('#Emailv').val(korisnik.Email);
                $('#IdVozaca').val(korisnik.Automobil.IdVozaca);
                $('#GodisteAutomobila').val(korisnik.Automobil.GodisteAutomobila);
                $('#BrojRegistarskeOznake').val(korisnik.Automobil.BrojRegistarskeOznake);
                $('#BrojTaksiVozila').val(korisnik.Automobil.BrojTaksiVozila);
                if (korisnik.Automobil.TipAutomobila == 0) {
                    $('#TipAutomobila1').prop('checked', true);
                } else {
                    $('#TipAutomobila2').prop('checked', true);
                }
                $('#glavni3').fadeIn(500);
            })
            //kraj linka izmeni

            //dugme izmeniii
            $('#glavni').on('click', '#izmena', function () {
                let pol;
                if ($('#Pol1').prop('checked')) {
                    pol = 'Muski';
                } else if ($('#Pol2').prop('checked')) {
                    pol = 'Zenski';
                }
                let KorisnikIzmena = {
                    Id: korisnickiId,
                    KorisnickoIme: `${$('#KorisnickoIme').val()}`,
                    Lozinka: `${$('#Lozinka').val()}`,
                    Ime: `${$('#Ime').val()}`,
                    Prezime: `${$('#Prezime').val()}`,
                    Pol: pol,
                    JMBG: `${$('#JMBG').val()}`,
                    KontaktTelefon: `${$('#KontaktTelefon').val()}`,
                    Email: `${$('#Email').val()}`,
                    Uloga: `${'Musterija'}`,
                    Voznje: `${'nema'}`,
                    Banovan: `${"NE"}`
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Registration/' + KorisnikIzmena.Id,
                    data: JSON.stringify(KorisnikIzmena),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (!data) {
                            alert("Korisničko ime koje zahtevate, već postoji!");
                        } else {
                            alert("Uspešno ste izmenili podatke!");
                            localStorage.setItem("Ulogovan", KorisnikIzmena.KorisnickoIme);
                            Korisnik.KorisnickoIme = KorisnikIzmena.KorisnickoIme;
                        }
                    }
                })
            })

            $('#glavni2').on('click', '#izmenad', function () {
                let pol;
                if ($('#Pol1d').prop('checked')) {
                    pol = 'Muski';
                } else if ($('#Pol2d').prop('checked')) {
                    pol = 'Zenski';
                }
                let KorisnikIzmena = {
                    Id: korisnickiId,
                    KorisnickoIme: `${$('#KorisnickoImed').val()}`,
                    Lozinka: `${$('#Lozinkad').val()}`,
                    Ime: `${$('#Imed').val()}`,
                    Prezime: `${$('#Prezimed').val()}`,
                    Pol: pol,
                    JMBG: `${$('#JMBGd').val()}`,
                    KontaktTelefon: `${$('#KontaktTelefond').val()}`,
                    Email: `${$('#Emaild').val()}`,
                    Uloga: `${'Dispecer'}`,
                    Voznje: `${'nema'}`,
                    Banovan: `${"NE"}`
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Dispecer/' + korisnickiId,
                    data: JSON.stringify(KorisnikIzmena),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (!data) {
                            alert("Korisničko ime koje zahtevate, već postoji!");
                        } else {
                            alert("Uspešno ste izmenili podatke!");
                            localStorage.setItem("Ulogovan", KorisnikIzmena.KorisnickoIme);
                            Korisnik.KorisnickoIme = KorisnikIzmena.KorisnickoIme;
                        }
                    }
                })
            })

            $('#glavni3').on('click', '#izmenav', function () {
                let pol;
                if ($('#Pol1v').prop('checked')) {
                    pol = 'Muski';
                } else if ($('#Pol2v').prop('checked')) {
                    pol = 'Zenski';
                }
                let tipAutomobila;
                if ($('#TipAutomobila1').prop('checked')) {
                    tipAutomobila = 'Putnicki';
                } else if ($('#TipAutomobila2').prop('checked')) {
                    tipAutomobila = 'Kombi';
                }

                let adresa = {
                    UlicaBroj: korisnik.Lokacija.Adresa.UlicaBroj,
                    NaseljenoMesto: korisnik.Lokacija.Adresa.NaseljenoMesto,
                    PozivniBroj: korisnik.Lokacija.Adresa.PozivniBroj
                }

                let lokacija = {
                    X: korisnik.Lokacija.X,
                    Y: korisnik.Lokacija.Y,
                    Adresa: adresa
                }
                let automobil = {
                    IdVozaca: korisnickiId,
                    GodisteAutomobila: `${$('#GodisteAutomobila').val()}`,
                    BrojRegistarskeOznake: `${$('#BrojRegistarskeOznake').val()}`,
                    BrojTaksiVozila: `${$('#BrojTaksiVozila').val()}`,
                    TipAutomobila: tipAutomobila
                }
                let KorisnikIzmena = {
                    Id: korisnickiId,
                    KorisnickoIme: `${$('#KorisnickoImev').val()}`,
                    Lozinka: `${$('#Lozinkav').val()}`,
                    Ime: `${$('#Imev').val()}`,
                    Prezime: `${$('#Prezimev').val()}`,
                    Pol: pol,
                    JMBG: `${$('#JMBGv').val()}`,
                    KontaktTelefon: `${$('#KontaktTelefonv').val()}`,
                    Email: `${$('#Emailv').val()}`,
                    Uloga: 'Vozac',
                    Voznje: 'nema',
                    Banovan: `${"NE"}`,
                    Lokacija: lokacija,
                    Automobil: automobil,
                    Zauzet: korisnik.Zauzet
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Vozac/' + korisnickiId,
                    data: JSON.stringify(KorisnikIzmena),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (!data) {
                            alert("Korisničko ime koje zahtevate, već postoji!");
                        } else {
                            alert("Uspešno ste izmenili podatke!");
                            localStorage.setItem("Ulogovan", KorisnikIzmena.KorisnickoIme);
                            Korisnik.KorisnickoIme = KorisnikIzmena.KorisnickoIme;
                        }
                    }
                })
            })
            //kraj izmenii

            $('#odjavi,#odjavid,#odjaviv').click(function () {
                localStorage.setItem("Ulogovan", "");
                $(location).attr('href', 'index.html');

            })

            //HOME DUGMICI
            //dodaj posle da se sakrije i za pretragu i sve novije dodato
            $('#dugmeHome').click(function () {
                $('#glavni').hide();

                //opet ide zahtev za voznjama da bi ucitali eventualno nove dodate
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(korisnik.Id),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {

                        let s = '';
                        s += '<div id="voznje" style="font-size:14px">';
                        s += '<h3 style="margin-left:44%;position:absolute;"><b>Moje vožnje</b></h3>';
                        s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Dispečer</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';


                        for (let i = 0; i < data.length; i++) {
                            if (data[i].Musterija == localStorage.getItem("Ulogovan")) {
                                s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                if (data[i].Dispecer == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Dispecer + '</td>');
                                }

                                if (data[i].Vozac == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Vozac + '</td>');
                                }

                                s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");
                                switch (data[i].Automobil) {
                                    case 0:
                                        s += "Putnički";
                                        break;
                                    case 1:
                                        s += "Kombi";
                                        break;
                                    case 2:
                                        s += "Svejedno";
                                }

                                if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                    s += ("</td><td>/" + "</td>");
                                }
                                else {
                                    s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                }

                                if (data[i].Iznos != "0") {
                                    s += ("<td>" + data[i].Iznos + "</td>");
                                } else {
                                    s += ("<td>/</td>");
                                }

                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                if (data[i].Komentar.Opis == "") {
                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                } else {
                                    s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                }

                                s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                    s += (`<input type="button" value="Odustani" id="odustani" class="obtn" name=${data[i].IdVoznje} /><br /><br />`);
                                    s += (`<input type="button" value="  Izmeni " id="izmeniVoznjuD" class="ibtn" name=${data[i].IdVoznje} />`);
                                } else if (vratiStatusVoznje(data[i].StatusVoznje) == "Uspešna") {
                                    s += (`<input type="button" value=" Komentar " id="dodajKomentarUspesna" class="kombtn" name=${data[i].IdVoznje} />`);
                                } else {
                                    s += ("Nedostupne");
                                }
                                s += (`</td></tr>`)
                            }
                        }

                        s += '</table></div>';
                        $('#glavni').html(s);
                    }
                })

                $('#glavni').fadeIn(500);
            })

            $('#moje').click(function () {
                $('#glavni2').hide();
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja' ,
                    //data: JSON.stringify(korisnik.Id),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {


                        let s = '';
                        s += '<div id="voznjeD" style="font-size:14px">';
                        s += '<h3 style="margin-left:44%;position:absolute;"><b>Moje vožnje</b></h3>';
                        s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';


                        for (let i = 0; i < data.length; i++) {
                            if (data[i].Dispecer == localStorage.getItem("Ulogovan")) {
                                s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                if (data[i].Musterija == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Musterija + '</td>');
                                }

                                if (data[i].Vozac == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Vozac + '</td>');
                                }

                                s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                switch (data[i].Automobil) {
                                    case 0:
                                        s += "Putnički";
                                        break;
                                    case 1:
                                        s += "Kombi";
                                        break;
                                    case 2:
                                        s += "Svejedno";
                                }

                                if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                    s += ("</td><td>/" + "</td>");
                                }
                                else {
                                    s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                }

                                if (data[i].Iznos != "0") {
                                    s += ("<td>" + data[i].Iznos + "</td>");
                                } else {
                                    s += ("<td>/</td>");
                                }

                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                if (data[i].Komentar.Opis == "") {
                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                } else {
                                    s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                }

                                s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                    s += (`<input type="button" value="Obradi" id="obradi" class="obradibtn" name=${data[i].IdVoznje} /><br /><br />`);
                                } else {
                                    s += ("Nedostupne");
                                }
                                s += (`</td></tr>`)
                            }
                        }

                        s += '</table>';
                        $('#glavni2').html(s);
                    }
                })
                $('#glavni2').fadeIn(500);
            })


            $('#sve').click(function () {
                $('#glavni2').hide();
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(korisnik.Id),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                            
                            let s = '';
                            s += '<div id="voznjeD" style="font-size:14px">';
                            s += '<h3 style="margin-left:44%;position:absolute;"><b>Sve vožnje</b></h3>';
                        s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';


                            for (let i = 0; i < data.length; i++) {
                                s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                if (data[i].Musterija == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Musterija + '</td>');
                                }

                                if (data[i].Vozac == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Vozac + '</td>');
                                }

                                s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                switch (data[i].Automobil) {
                                    case 0:
                                        s += "Putnički";
                                        break;
                                    case 1:
                                        s += "Kombi";
                                        break;
                                    case 2:
                                        s += "Svejedno";
                                }

                                if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                    s += ("</td><td>/" + "</td>");
                                }
                                else {
                                    s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                }

                                if (data[i].Iznos != "0") {
                                    s += ("<td>" + data[i].Iznos + "</td>");
                                } else {
                                    s += ("<td>/</td>");
                                }

                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                if (data[i].Komentar.Opis == "") {
                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                } else {
                                    s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                }

                                s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                    s += (`<input type="button" value="Obradi" id="obradi" class="obradibtn" name=${data[i].IdVoznje} /><br /><br />`);
                                } else {
                                    s += ("Nedostupne");
                                }
                                s += (`</td></tr>`);
                            }

                            s += '</table>';
                            $('#glavni2').html(s);
                    }
                })
                $('#glavni2').fadeIn(500);
            })


            $('#nacekanju').click(function () {
                $('#glavni2').hide();
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(korisnik.Id),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {


                        let s = '';
                        s += '<div id="voznjeD" style="font-size:14px">';
                        s += '<h3 style="margin-left:44%;position:absolute;"><b>Vožnje na čekanju</b></h3>';
                        s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';


                        for (let i = 0; i < data.length; i++) {
                            if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                if (data[i].Musterija == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Musterija + '</td>');
                                }

                                if (data[i].Vozac == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Vozac + '</td>');
                                }

                                s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");


                                switch (data[i].Automobil) {
                                    case 0:
                                        s += "Putnički";
                                        break;
                                    case 1:
                                        s += "Kombi";
                                        break;
                                    case 2:
                                        s += "Svejedno";
                                }

                                if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                    s += ("</td><td>/" + "</td>");
                                }
                                else {
                                    s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                }

                                if (data[i].Iznos != "0") {
                                    s += ("<td>" + data[i].Iznos + "</td>");
                                } else {
                                    s += ("<td>/</td>");
                                }

                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                if (data[i].Komentar.Opis == "") {
                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                } else {
                                    s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                }

                                s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                    s += (`<input type="button" value="Obradi" id="obradi" class="obradibtn" name=${data[i].IdVoznje} /><br /><br />`);
                                } else {
                                    s += ("Nedostupne");
                                }
                                s += (`</td></tr>`);
                            }
                        }

                        s += '</table>';
                        $('#glavni2').html(s);
                    }
                })
                $('#glavni2').fadeIn(500);
            })

            $('#mojeVozac').click(function () {
                $('#glavni3').hide();
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(korisnik.Id),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        let s = '';
                        s += ' <div id="voznjeV" style="font-size:14px">';
                        s += '<h3 style="margin-left:44%;position:absolute;"><b>Moje vožnje</b></h3>';
                        s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Dispečer</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';

                        for (let i = 0; i < data.length; i++) {
                            if (data[i].Vozac == localStorage.getItem("Ulogovan")) {
                                s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                if (data[i].Musterija == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Musterija + '</td>');
                                }

                                if (data[i].Dispecer == "") {
                                    s += '<td>/</td>';
                                } else {
                                    s += ('<td>' + data[i].Dispecer + '</td>');
                                }

                                s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                switch (data[i].Automobil) {
                                    case 0:
                                        s += "Putnički";
                                        break;
                                    case 1:
                                        s += "Kombi";
                                        break;
                                    case 2:
                                        s += "Svejedno";
                                }

                                if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                    s += ("</td><td>/" + "</td>");
                                }
                                else {
                                    s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                }

                                if (data[i].Iznos != "0") {
                                    s += ("<td>" + data[i].Iznos + "</td>");
                                } else {
                                    s += ("<td>/</td>");
                                }

                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                if (data[i].Komentar.Opis == "") {
                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                } else {
                                    s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                }

                                s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {//copy paste ovde nece sigurno uci (msm u prvi slucaj jer cim ima njegov id ne moze biti kreirana (u tom stanju))
                                    s += (`<input type="button" value="Prihvati" id="Prihvati" class="prihvatibtn" name=${data[i].IdVoznje} /><br /><br />`);
                                } else if (vratiStatusVoznje(data[i].StatusVoznje) == "Prihvaćena" || vratiStatusVoznje(data[i].StatusVoznje) == "Obradjena" || vratiStatusVoznje(data[i].StatusVoznje) == "Formirana") {
                                    s += (`<input type="button" value=" Uspešna  " id="uspesna" class="uspesnabtn" name=${data[i].IdVoznje} /><br /><br />`);
                                    s += (`<input type="button" value="Neuspešna" id="neuspesna" class="neuspesnabtn" name=${data[i].IdVoznje} /><br />`);
                                } else {
                                    s += ("Nedostupne");
                                }
                                s += (`</td></tr>`);
                            }
                        }

                        s += '</table></div>';
                        $('#glavni3').html(s);
                    }
                })

                $('#glavni3').fadeIn(500);
            })

            $('#nacekanjuVozac').click(function () {
                $('#glavni3').hide();
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(korisnik.Id),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        //trazim ulogovanog da bi mogao ispitati njegovo zauzece zbog PRIHVATI dugmica
                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac',
                            data: { KorisnickoIme: `${localStorage.getItem("Ulogovan")}` },
                            contentType: 'application/json;charset=utf-8',
                            dataType: 'json',
                            success: function (dataV) {
                                let s = '';
                                s += ' <div id="voznjeV" style="font-size:14px">';
                                s += '<h3 style="margin-left:44%;position:absolute;"><b>Vožnje na čekanju</b></h3>';
                                s += '<table border=1 class="voznje boja"><tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Dispečer</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th><th>Opcije</th></tr>';

                                for (let i = 0; i < data.length; i++) {
                                    if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana" && (dataV.Automobil.TipAutomobila == data[i].Automobil || data[i].Automobil == 2)) {
                                        s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                        if (data[i].Musterija == "") {
                                            s += '<td>/</td>';
                                        } else {
                                            s += ('<td>' + data[i].Musterija + '</td>');
                                        }

                                        if (data[i].Dispecer == "") {
                                            s += '<td>/</td>';
                                        } else {
                                            s += ('<td>' + data[i].Dispecer + '</td>');
                                        }

                                        s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                        switch (data[i].Automobil) {
                                            case 0:
                                                s += "Putnički";
                                                break;
                                            case 1:
                                                s += "Kombi";
                                                break;
                                            case 2:
                                                s += "Svejedno";
                                        }

                                        if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                            s += ("</td><td>/" + "</td>");
                                        }
                                        else {
                                            s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                        }

                                        if (data[i].Iznos != "0") {
                                            s += ("<td>" + data[i].Iznos + "</td>");
                                        } else {
                                            s += ("<td>/</td>");
                                        }

                                        s += ('<td><textarea rows="5" cols="30" disabled>');

                                        if (data[i].Komentar.Opis == "") {
                                            s += ("Komentar nije dodat!" + "</textarea ></td >");
                                        } else {
                                            s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                        }

                                        s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> <td>");

                                        if (vratiStatusVoznje(data[i].StatusVoznje) == "Kreirana") {
                                            s += (`<input type="button" value="Prihvati" id="Prihvati" class="prihvatibtn" name=${data[i].IdVoznje} /><br /><br />`);
                                        } else {
                                            s += ("Nedostupne");
                                        }
                                        s += (`</td></tr>`);
                                    }
                                }

                                s += '</table></div>';
                                $('#glavni3').html(s);
                            }
                        })
                    }
                })
                $('#glavni3').fadeIn(500);
            })

            //ya ovo iznad KAD VOZAC STISNE PRIHVATI!

            $(document).on('click', '.prihvatibtn', function () {
                let idVoznje = $(this).prop('name');

                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    data: { KorisnickoIme: `${korisnik.KorisnickoIme}` },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (dataV) {
                        if (dataV.Zauzet == "NE") {
                            let VozacAdresaMenjamStanje = {
                                UlicaBroj: `${dataV.Lokacija.Adresa.UlicaBroj}`,
                                NaseljenoMesto: `${dataV.Lokacija.Adresa.NaseljenoMesto}`,
                                PozivniBroj: `${dataV.Lokacija.Adresa.PozivniBroj}`
                            }

                            let VozacLokacijaMenjamStanje = {
                                X: `${dataV.Lokacija.X}`,
                                Y: `${dataV.Lokacija.Y}`,
                                Adresa: VozacAdresaMenjamStanje
                            }

                            let Auto = {
                                IdVozaca: `${dataV.Automobil.IdVozaca}`,
                                GodisteAutomobila: `${dataV.Automobil.GodisteAutomobila}`,
                                BrojRegistarskeOznake: `${dataV.Automobil.BrojRegistarskeOznake}`,
                                BrojTaksiVozila: `${dataV.Automobil.BrojTaksiVozila}`,
                                TipAutomobila: `${dataV.Automobil.TipAutomobila}`
                            }

                            let NovoStanjeVozac = {
                                Id: `${dataV.Id}`,
                                KorisnickoIme: `${dataV.KorisnickoIme}`,
                                Lozinka: `${dataV.Lozinka}`,
                                Ime: `${dataV.Ime}`,
                                Prezime: `${dataV.Prezime}`,
                                Pol: `${dataV.Pol}`,
                                JMBG: `${dataV.JMBG}`,
                                KontaktTelefon: `${dataV.KontaktTelefon}`,
                                Email: `${dataV.Email}`,
                                Uloga: `${dataV.Uloga}`,
                                Voznje: `${dataV.Voznje}`,
                                Banovan: `${"NE"}`,
                                Lokacija: VozacLokacijaMenjamStanje,
                                Automobil: Auto,
                                Zauzet: "DA"
                            }


                            $.ajax({
                                type: 'PUT',
                                url: '/api/Vozac/' + dataV.Id,
                                data: JSON.stringify(NovoStanjeVozac),
                                contentType: 'application/json;charset=utf-8',
                                dataType: 'json',
                                success: function (data) {
                                    if (data) {

                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Voznja/' + idVoznje,
                                            // data: JSON.stringify(KomentarOtkazaneVoznja),
                                            contentType: 'application/json;charset=utf-8',
                                            dataType: 'json',
                                            success: function (dataVZ) {

                                                let addr = {
                                                    UlicaBroj: `${dataVZ.Lokacija.Adresa.UlicaBroj}`,
                                                    NaseljenoMesto: `${dataVZ.Lokacija.Adresa.NaseljenoMesto}`,
                                                    PozivniBroj: `${dataVZ.Lokacija.Adresa.PozivniBroj}`
                                                }

                                                let lok = {
                                                    X: `${dataVZ.Lokacija.X}`,
                                                    Y: `${dataVZ.Lokacija.Y}`,
                                                    Adresa: addr
                                                }

                                                let addr2 = {
                                                    UlicaBroj: `${dataVZ.Odrediste.Adresa.UlicaBroj}`,
                                                    NaseljenoMesto: `${dataVZ.Odrediste.Adresa.NaseljenoMesto}`,
                                                    PozivniBroj: `${dataVZ.Odrediste.Adresa.PozivniBroj}`
                                                }

                                                let lok2 = {
                                                    X: `${dataVZ.Odrediste.X}`,
                                                    Y: `${dataVZ.Odrediste.Y}`,
                                                    Adresa: addr2
                                                }

                                                let kom = {
                                                    Opis: `${dataVZ.Komentar.Opis}`,
                                                    DatumObjave: `${dataVZ.Komentar.DatumObjave}`,
                                                    IdVoznje: `${dataVZ.Komentar.IdVoznje}`,
                                                    KorisnickoIme: `${dataVZ.Komentar.KorisnickoIme}`,
                                                    Ocena: `${dataVZ.Komentar.Ocena}`
                                                }

                                                let VoznjaNakonObrade = {
                                                    IdVoznje: idVoznje,
                                                    DatumVreme: `${dataVZ.DatumVreme}`,
                                                    Lokacija: lok,
                                                    Automobil: `${dataVZ.TipAutomobila}`,
                                                    Musterija: `${dataVZ.Musterija}`,
                                                    Odrediste: lok2,
                                                    Dispecer: "",
                                                    Vozac: `${dataV.KorisnickoIme}`,
                                                    Iznos: `${dataVZ.Iznos}`,
                                                    Komentar: kom,
                                                    StatusVoznje: 3//jer je prihvata vozac ide u stanje ptihvacena
                                                }

                                                //update voznje
                                                $.ajax({
                                                    type: 'PUT',
                                                    url: '/api/Voznja/' + idVoznje,
                                                    data: JSON.stringify(VoznjaNakonObrade),
                                                    contentType: 'application/json;charset=utf-8',
                                                    dataType: 'json',
                                                    success: function () {
                                                        alert("Uspešno ste prihvatili vožnju!");
                                                        $(location).attr('href', 'main.html');
                                                    }
                                                })
                                            }
                                        })
                                    }
                                }
                            })
                        } else {
                            alert("Ne možete prihvatiti vožnju, jer ste već zauzeti!");
                        }
                    }
                })

            })

            //KRAJ ya ovo iznad KAD VOZAC STISNE PRIHVATI!

            //kraj HOME dugmadi

            //dodaj vozaca iz dispecera (NIJE DUGME)
            $('#novVozac').click(function () {
                $('#glavni2').hide();

                let s = '';

                s += '<div id="dodavanjeVozaca">';
                s += '  <table class="w3-small">';
                s += '      <tr><th>Korisničko ime:</th><td><input type="text" name="KorisnickoImeVDodaj" id="KorisnickoImeVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Lozinka:</th><td><input type="text" name="LozinkaVDodaj" id="LozinkaVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Ime:</th><td><input type="text" name="ImeVDodaj" id="ImeVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Prezime:</th><td><input type="text" name="PrezimeVDodaj" id="PrezimeVDodaj" style="margin:5px" /></td></tr>';
                s += '     <tr><th>JMBG:</th><td><input type="text" name="JMBGVDodaj" id="JMBGVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Pol:</th><td><label>Muški:&nbsp&nbsp</label><input type="radio" name="PolVDodaj" value="Muski" id="Pol1VDodaj" /><label>&nbsp&nbspŽenski:&nbsp&nbsp</label><input type="radio" value="Zenski" name="PolVDodaj" id="Pol2VDodaj" /></td></tr>';
                s += '      <tr><th>Kontakt Telefon:</th><td><input type="text" name="KontaktTelefonVDodaj" id="KontaktTelefonVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Email:</th><td><input type="email" name="EmailVDodaj" id="EmailVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Lokacija X:</th><td><input type="text" name="LokacijaXVDodaj" id="LokacijaXVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Lokacija Y:</th><td><input type="text" name="LokacijaYVDodaj" id="LokacijaYVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Ulica i broj:</th><td><input type="text" name="UlicaBrojVDodaj" id="UlicaBrojVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Naseljeno mesto:</th><td><input type="text" name="NaseljenoMestoVDodaj" id="NaseljenoMestoVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Pozivni broj:</th><td><input type="text" name="PozivniBrojVDodaj" id="PozivniBrojVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Godište automobila:</th><td><input type="text" name="GodisteAutomobilaVDodaj" id="GodisteAutomobilaVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Registarske oznake:</th><td><input type="text" name="BrojRegistarskeOznakeVDodaj" id="BrojRegistarskeOznakeVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Taxi broj:</th><td><input type="text" name="BrojTaksiVozilaVDodaj" id="BrojTaksiVozilaVDodaj" style="margin:5px" /></td></tr>';
                s += '      <tr><th>Vrsta vozila:</th><td><label>Putnički:&nbsp&nbsp</label><input type="radio" name="TipAutomobilaVDodaj" value="Putnički" id="TipAutomobila1VDodaj" /><label>&nbsp&nbspKombi:&nbsp&nbsp</label><input type="radio" value="Kombi" name="TipAutomobilaVDodaj" id="TipAutomobila2VDodaj" /></td></tr>';
                s += '     <tr><td colspan="2"><hr /></td></tr>';
                s += '     <tr><td colspan="2" align="right"><b><input type="button" value="Dodaj" id="VDodaj" /></b></td></tr>';
                s += '  </table>';
                s += '</div>';

                $('#glavni2').html(s);
                $('#glavni2').fadeIn(500);
            })

            //dodaj vozaca (DUGME)

            $('#glavni2').on('click', '#VDodaj', function () {
                let pol;
                if ($('#Pol1VDodaj').prop('checked')) {
                    pol = 'Muski';
                } else if ($('#Pol2VDodaj').prop('checked')) {
                    pol = 'Zenski';
                }
                let tipAutomobila;
                if ($('#TipAutomobila1VDodaj').prop('checked')) {
                    tipAutomobila = 'Putnicki';
                } else if ($('#TipAutomobila2VDodaj').prop('checked')) {
                    tipAutomobila = 'Kombi';
                }

                let adresa = {
                    UlicaBroj: `${$('#UlicaBrojVDodaj').val()}`,
                    NaseljenoMesto: `${$('#NaseljenoMestoVDodaj').val()}`,
                    PozivniBroj: `${$('#PozivniBrojVDodaj').val()}`
                }

                let lokacija = {
                    X: `${$('#LokacijaXVDodaj').val()}`,
                    Y: `${$('#LokacijaYVDodaj').val()}`,
                    Adresa: adresa
                }
                let automobil = {
                    IdVozaca: "",
                    GodisteAutomobila: `${$('#GodisteAutomobilaVDodaj').val()}`,
                    BrojRegistarskeOznake: `${$('#BrojRegistarskeOznakeVDodaj').val()}`,
                    BrojTaksiVozila: `${$('#BrojTaksiVozilaVDodaj').val()}`,
                    TipAutomobila: tipAutomobila
                }
                let NovVozac = {
                    Id: "",
                    KorisnickoIme: `${$('#KorisnickoImeVDodaj').val()}`,
                    Lozinka: `${$('#LozinkaVDodaj').val()}`,
                    Ime: `${$('#ImeVDodaj').val()}`,
                    Prezime: `${$('#PrezimeVDodaj').val()}`,
                    Pol: pol,
                    JMBG: `${$('#JMBGVDodaj').val()}`,
                    KontaktTelefon: `${$('#KontaktTelefonVDodaj').val()}`,
                    Email: `${$('#EmailVDodaj').val()}`,
                    Uloga: `${'Vozac'}`,
                    Voznje: `${'nema'}`,
                    Banovan: `${"NE"}`,
                    Lokacija: lokacija,
                    Automobil: automobil
                };

                $.ajax({
                    type: 'POST',
                    url: '/api/Vozac',
                    data: JSON.stringify(NovVozac),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (!data) {
                            alert("Korisničko ime koje ste uneli već postoji!");
                        } else {
                            alert("Uspešno ste dodali novog vozača!");
                        }
                    }
                })
            })
            //KRAJ DODAVANJA VOZACA


            //KORISNIK DODAJE VOZNJU

            $('#korisnikDodajVoznju').click(function () {
                $('#glavni').hide();
                
                let s = '';
                s += '<div id="divNovaVoznja">';
                s += '  <table style="position:absolute;margin-left:3%;margin-top:3%;">';
                s += '     <tr ><th colspan="2">Unesite podatke o novoj vožnji:</th></tr>';
                s += '    <tr ><td colsapn="2"><hr /></td></tr>';
                s += '    <tr><td >Koordinata X:</td><td><input type="text" style="margin:5px;" name="korisnikLokacijaX" id="korisnikLokacijaX" /></td></tr';
                s += '    <tr><td>Koordinata Y:</td><td><input type="text" style="margin:5px;" name="korisnikLokacijaY" id="korisnikLokacijaY" /></td></tr>';
                s += '    <tr><td>Ulica i broj:</td><td><input type="text" style="margin:5px;" name="korisnikUlicaBroj" id="korisnikUlicaBroj" /></td></tr>';
                s += '     <tr><td>Naseljeno mesto:</td><td><input type="text" style="margin:5px;" name="korisnikNaseljenoMesto" id="korisnikNaseljenoMesto" /></td></tr>';
                s += '     <tr><td>Pozivni broj:</td><td><input type="text" style="margin:5px;" name="korisnikPozivniBroj" id="korisnikPozivniBroj" /></td></tr>';
                s += '     <tr><td>Željeni tip automobila:</td><td><label>&nbspPutnički:&nbsp&nbsp</label><input type="radio" style="margin:5px;" name="korisnikTipAuta" value="Putnicki" id="korisnikTipAuta1" /><label>&nbsp&nbspKombi:&nbsp&nbsp</label><input type="radio" value="Kombi" style="margin:5px;" name="korisnikTipAuta" id="korisnikTipAuta2" /></td></tr>';
                s += '     <tr><td colspan="2" align="right"><input type="button" style="margin:5px;" name="DodajVoznju" id="DodajVoznju" value="Dodaj" /></td></tr>';
                s += ' </table>';
                s += ' </div>';

                $('#glavni').html(s);

                $('#glavni').fadeIn(500);
            })

            $('#glavni').on('click', '#DodajVoznju', function () {
                let tipAutomobila;

                if ($('#korisnikTipAuta1').prop('checked')) {
                    tipAutomobila = 'Putnicki';
                } else if ($('#korisnikTipAuta2').prop('checked')) {
                    tipAutomobila = 'Kombi';
                } else {
                    tipAutomobila = 'Svejedno';
                }

                let AdresaKorisnikDodajeVoznju = {
                    UlicaBroj: `${$('#korisnikUlicaBroj').val()}`,
                    NaseljenoMesto: `${$('#korisnikNaseljenoMesto').val()}`,
                    PozivniBroj: `${$('#korisnikPozivniBroj').val()}`
                }

                let LokacijaKorisnikDodajeVoznju = {
                    X: `${$('#korisnikLokacijaX').val()}`,
                    Y: `${$('#korisnikLokacijaY').val()}`,
                    Adresa: AdresaKorisnikDodajeVoznju
                }

                let AdresaKorisnikDodajeVoznju2 = {
                    UlicaBroj: "",
                    NaseljenoMesto: "",
                    PozivniBroj: ""
                }

                let LokacijaKorisnikDodajeVoznju2 = {
                    X: "",
                    Y: "",
                    Adresa: AdresaKorisnikDodajeVoznju2
                }

                let komentar = {
                    Opis: "",
                    DatumObjave: "",
                    KorisnickoIme: "",
                    IdVoznje: "",
                    Ocena:""
                }

                let NovaVoznjaKorisnika = {
                    IdVoznje: "",
                    DatumVreme: "",
                    Lokacija: LokacijaKorisnikDodajeVoznju,
                    Automobil: tipAutomobila,
                    Musterija: `${localStorage.getItem("Ulogovan")}`,
                    Odrediste: LokacijaKorisnikDodajeVoznju2,
                    Dispecer: "",
                    Vozac: "",
                    Iznos: "",
                    Komentar: komentar,
                    StatusVoznje:0
                }

                $.ajax({
                    type: 'POST',
                    url: '/api/Voznja',
                    data: JSON.stringify(NovaVoznjaKorisnika),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (!data) {
                            alert("Vožnja nije dodata!");
                        } else {
                            alert("Uspešno ste dodali novu vožnju!");
                        }
                    }
                })
            })

            //KRAJ KORISNIK DODAJE VOZNJU

            //VOZAC MENJA LOKACIJU
            $('#menjamLokaciju').click(function () {
                $('#glavni3').hide();

                let s = '';
                s += '<div id="lokacijaClass">';
                s += '  <table style="position:absolute;margin-left:3%;margin-top:3%;">';
                s += '     <tr ><th colspan="2">Unesite podatke o svojoj lokaciji:</th></tr>';
                s += '    <tr ><td colsapn="2"><hr /></td></tr>';
                s += '    <tr><td >Koordinata X:</td><td><input type="text" style="margin:5px;" name="vozacLokacijaX" id="vozacLokacijaX" /></td></tr';
                s += '    <tr><td>Koordinata Y:</td><td><input type="text" style="margin:5px;" name="vozacLokacijaY" id="vozacLokacijaY" /></td></tr>';
                s += '    <tr><td>Ulica i broj:</td><td><input type="text" style="margin:5px;" name="vozacUlicaBroj" id="vozacUlicaBroj" /></td></tr>';
                s += '     <tr><td>Naseljeno mesto:</td><td><input type="text" style="margin:5px;" name="vozacNaseljenoMesto" id="vozacNaseljenoMesto" /></td></tr>';
                s += '     <tr><td>Pozivni broj:</td><td><input type="text" style="margin:5px;" name="vozacPozivniBroj" id="vozacPozivniBroj" /></td></tr>';
                s += '     <tr><td colspan="2" align="right"><input type="button" style="margin:5px;" name="izmeniLokaciju" id="izmeniLokaciju" value="Promeni" /></td></tr>';
                s += ' </table>';
                s += ' </div>';

                $('#glavni3').html(s);

                $('#glavni3').fadeIn(500);
            })
            //klik na dugme Izmeni lokaciju

            $('#glavni3').on('click', '#izmeniLokaciju', function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    data: { KorisnickoIme: `${korisnik.KorisnickoIme}` },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (dataV) {
                        if (dataV.Zauzet == "NE") {
                            let AdresaVozacMenjaLokaciju = {
                                UlicaBroj: `${$('#vozacUlicaBroj').val()}`,
                                NaseljenoMesto: `${$('#vozacNaseljenoMesto').val()}`,
                                PozivniBroj: `${$('#vozacPozivniBroj').val()}`
                            }

                            let LokacijaVozacMenjaLokaciju = {
                                X: `${$('#vozacLokacijaX').val()}`,
                                Y: `${$('#vozacLokacijaY').val()}`,
                                Adresa: AdresaVozacMenjaLokaciju
                            }

                            let Auto = {
                                IdVozaca: dataV.Id,
                                GodisteAutomobila: dataV.Automobil.GodisteAutomobila,
                                BrojRegistarskeOznake: dataV.Automobil.BrojRegistarskeOznake,
                                BrojTaksiVozila: dataV.Automobil.BrojTaksiVozila,
                                TipAutomobila: dataV.Automobil.TipAutomobila
                            }

                            let NovaLokacijaVozac = {
                                Id: `${dataV.Id}`,
                                KorisnickoIme: `${dataV.KorisnickoIme}`,
                                Lozinka: `${dataV.Lozinka}`,
                                Ime: `${dataV.Ime}`,
                                Prezime: `${dataV.Prezime}`,
                                Pol: `${dataV.Pol}`,
                                JMBG: `${dataV.JMBG}`,
                                KontaktTelefon: `${dataV.KontaktTelefon}`,
                                Email: `${dataV.Email}`,
                                Uloga: `${dataV.Uloga}`,
                                Voznje: `${dataV.Voznje}`,
                                Banovan: `${"NE"}`,
                                Lokacija: LokacijaVozacMenjaLokaciju,
                                Automobil: Auto,
                                Zauzet: `${dataV.Zauzet}`
                            }

                            $.ajax({
                                type: 'PUT',
                                url: '/api/Vozac/' + dataV.Id,
                                data: JSON.stringify(NovaLokacijaVozac),
                                contentType: 'application/json;charset=utf-8',
                                dataType: 'json',
                                success: function (data) {
                                    if (!data) {
                                        alert("Lokacija nije izmenjena!");
                                    } else {
                                        alert("Uspešno ste izmenili lokaciju!");
                                    }
                                }
                            })
                        } else {
                            alert("Vozač ne može promeniti lokaciju, jer je trenutno zauzet!");
                            $(location).attr('href', 'main.html');
                        }
                    }
                })

            })

            //KRAJ VOZAC MENJA LOKACIJU


            //DUGMAD U TABELI
            //KLIK NA DUGME ODUSTANI U TABELI

            $(document).on('click', '.obtn', function () {
                let idVoznje = $(this).prop('name');
                idVoznja = idVoznje;


                $('#glavni').hide();
                let s = '';
                s += '<div class="komentar">';
                s += '<table style="position:absolute;"><tr><td colspan="2"><label>Obavezno unesite komentar:</label></td></tr>';
                s += '<tr><td colspan="2"><textarea name="textKom" id="textKom" cols="30" rows="5" placeholder="Ovde unesite komentar" /></td></tr>';
                s += '<tr><td>Odaberite ocenu:</td><td><select name="ocene" id="ocene"><option value="0" data-toggle="tooltip" title="Ne želim da ocenim">0</option><option value="1" data-toggle="tooltip" title="Jako loše">1</option><option value="2" data-toggle="tooltip" title="Loše">2</option><option value="3" data-toggle="tooltip" title="Dobro">3</option><option value="4" data-toggle="tooltip" title="Vrlo dobro">4</option><option value="5" data-toggle="tooltip" title="Odlično">5</option></select></td></tr>';
                s += '<tr><td colspan="2"><input type="button" name="dodajKom" id="dodajKom" value="U redu"/></td></tr></table></div>';
                $('#glavni').html(s);
                $('#glavni').fadeIn(500);

                // }

                // })
            })

            //KRAJ KLIK NA DUGME ODUSTANI U TABELI


            //KLIK NA DUGME IZMENI U TABELI
            $(document).on('click', '.ibtn', function () {
                let idVoznje = $(this).prop('name');
                idVoznja = idVoznje;

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(idVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {

                        for (let i = 0; i < data.length; i++) {
                            if (data[i].IdVoznje == idVoznja) {

                                $('#glavni').hide();
                                let s = '';
                                s += '<div class="izmenaVoznje"><h3>Ovde možete izmeniti svoju vožnju</h3>';
                                s += '<table style="position:absolute" >';
                                s += '<tr><td colspan="2"><hr/></td></tr>';
                                s += '<tr><td >Koordinata X:</td><td><input type="text" style="margin:5px;" name="izmenaKoordinataX" id="izmenaKoordinataX" required /></td></tr>';
                                s += '<tr><td>Koordinata Y:</td> <td><input type="text" style="margin:5px;" name="izmenaKoordinataY" id="izmenaKoordinataY" required /></td></tr >';
                                s += '<tr><td>Ulica i broj:</td> <td><input type="text" style="margin:5px;" name="izmenaUlicaBroj" id="izmenaUlicaBroj" required /></td></tr >';
                                s += '<tr><td>Naseljeno mesto:</td><td><input type="text" style="margin:5px;" name="izmenaNaseljenoMesto" id="izmenaNaseljenoMesto" required /></td></tr>';
                                s += '<tr><td> Pozivni broj:</td><td><input type="text" style="margin:5px;" name="izmenaPozivniBroj" id="izmenaPozivniBroj" required /></td></tr>';
                                s += '<tr><td>Željeni tip automobila:</td><td data-balloon="Ako vam je svejedno, nemojte odabrati tip!" data-balloon-pos="down"><label>&nbspPutnički:&nbsp&nbsp</label><input type="radio" style="margin:5px;" name="izmenaTipAuta" value="Putnicki" id="izmenaTipAuta1" /><label>&nbsp&nbspKombi:&nbsp&nbsp</label><input type="radio" value="Kombi" style="margin:5px;" name="izmenaTipAuta" id="izmenaTipAuta2" /></td></tr>';
                                s += '<tr><td colspan="2"><hr/></td></tr>';
                                s += '<tr><td colspan="2" style="text-align:right;"><input type="button" name="izmeniVoznju" id="izmeniVoznju" value="Izmeni"/></td></tr>';
                                s += "</table></div>";

                                $('#glavni').html(s);

                                $('#izmenaKoordinataX').val(data[i].Lokacija.X);
                                $('#izmenaKoordinataY').val(data[i].Lokacija.Y);
                                $('#izmenaUlicaBroj').val(data[i].Lokacija.Adresa.UlicaBroj);
                                $('#izmenaNaseljenoMesto').val(data[i].Lokacija.Adresa.NaseljenoMesto);
                                $('#izmenaPozivniBroj').val(data[i].Lokacija.Adresa.PozivniBroj);
                                if (data[i].TipAutomobila == 0) {
                                    $('#izmenaTipAuta1').prop('checked', true);
                                } else if (data[i].TipAutomobila == 1) {
                                    $('#izmenaTipAuta2').prop('checked', true);
                                }
                            }
                        }
                        $('#glavni').fadeIn(500);
                    }
                })
            })

            //KRAJ KLIK NA DUGME IZMENI U TABELI
            //KLIK NA DUGME OBRADI U TABELI
            $(document).on('click', '.obradibtn', function () {
                let idVoznje = $(this).prop('name');
                idVoznja = idVoznje;
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja/' + idVoznja,
                    // data: JSON.stringify(KomentarOtkazaneVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        $.ajax({
                            type: 'GET',
                            url: '/api/Vozac',
                            // data: JSON.stringify(KomentarOtkazaneVoznja),
                            contentType: 'application/json;charset=utf-8',
                            dataType: 'json',
                            success: function (dataV) {
                                if (dataV.length > 0) {
                                    let s = '';
                                    let usao = "ne";
                                    s += `<div style="position:absolute;"><h3>Moguć izbor vozača:</h3><br>Vozacev username: <select name="biloKo" id="biloKo">`;
                                    for (var i = 0; i < dataV.length; i++) {
                                        if (dataV[i].Zauzet == "NE") {
                                            if (data.Automobil == 2) {
                                                s += `<option value=${dataV[i].KorisnickoIme}>${dataV[i].KorisnickoIme}</option>`;
                                                usao = "da";
                                            } else if (data.Automobil == dataV[i].Automobil.TipAutomobila) {
                                                s += `<option value=${dataV[i].KorisnickoIme}>${dataV[i].KorisnickoIme}</option>`;
                                                usao = "da";
                                            }
                                        }   
                                    }
                                    if (usao == "da") {
                                        s += '<input type="button" name="dodeli" id="dodeli" value="Dodeli"/></div>';
                                        $('#glavni2').hide();
                                        $('#glavni2').html(s);
                                        $('#glavni2').fadeIn(500);

                                    } else {
                                        s = '';
                                        alert("Nemamo odgovarajućeg vozača!");
                                        $(location).attr('href', 'main.html');
                                    }
                                } else {
                                    alert("Nema vozača u sistemu!");
                                    $(location).attr('href', 'main.html');
                                }
                            }
                        })
                    }
                })
            })

            $('#glavni2').on('click', '#dodeli', function () {
                let odabranVozac = $('#biloKo').prop('value');

                //sledi update vozaca na zauzet
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    data: { KorisnickoIme: `${odabranVozac}` },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (dataV) {
                        let VozacAdresaMenjamStanje = {
                            UlicaBroj: `${dataV.Lokacija.Adresa.UlicaBroj}`,
                            NaseljenoMesto: `${dataV.Lokacija.Adresa.NaseljenoMesto}`,
                            PozivniBroj: `${dataV.Lokacija.Adresa.PozivniBroj}`
                        }

                        let VozacLokacijaMenjamStanje = {
                            X: `${dataV.Lokacija.X}`,
                            Y: `${dataV.Lokacija.Y}`,
                            Adresa: VozacAdresaMenjamStanje
                        }

                        let Auto = {
                            IdVozaca: `${dataV.Automobil.IdVozaca}`,
                            GodisteAutomobila: `${dataV.Automobil.GodisteAutomobila}`,
                            BrojRegistarskeOznake: `${dataV.Automobil.BrojRegistarskeOznake}`,
                            BrojTaksiVozila: `${dataV.Automobil.BrojTaksiVozila}`,
                            TipAutomobila: `${dataV.Automobil.TipAutomobila}`
                        }

                        let NovoStanjeVozac = {
                            Id: `${dataV.Id}`,
                            KorisnickoIme: `${dataV.KorisnickoIme}`,
                            Lozinka: `${dataV.Lozinka}`,
                            Ime: `${dataV.Ime}`,
                            Prezime: `${dataV.Prezime}`,
                            Pol: `${dataV.Pol}`,
                            JMBG: `${dataV.JMBG}`,
                            KontaktTelefon: `${dataV.KontaktTelefon}`,
                            Email: `${dataV.Email}`,
                            Uloga: `${dataV.Uloga}`,
                            Voznje: `${dataV.Voznje}`,
                            Banovan: `${"NE"}`,
                            Lokacija: VozacLokacijaMenjamStanje,
                            Automobil: Auto,
                            Zauzet: "DA"
                        }


                        $.ajax({
                            type: 'PUT',
                            url: '/api/Vozac/' + dataV.Id,
                            data: JSON.stringify(NovoStanjeVozac),
                            contentType: 'application/json;charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Voznja/' + idVoznja,
                                        // data: JSON.stringify(KomentarOtkazaneVoznja),
                                        contentType: 'application/json;charset=utf-8',
                                        dataType: 'json',
                                        success: function (data) {

                                            let addr = {
                                                UlicaBroj: `${data.Lokacija.Adresa.UlicaBroj}`,
                                                NaseljenoMesto: `${data.Lokacija.Adresa.NaseljenoMesto}`,
                                                PozivniBroj: `${data.Lokacija.Adresa.PozivniBroj}`
                                            }

                                            let lok = {
                                                X: `${data.Lokacija.X}`,
                                                Y: `${data.Lokacija.Y}`,
                                                Adresa: addr
                                            }

                                            let addr2 = {
                                                UlicaBroj: `${data.Odrediste.Adresa.UlicaBroj}`,
                                                NaseljenoMesto: `${data.Odrediste.Adresa.NaseljenoMesto}`,
                                                PozivniBroj: `${data.Odrediste.Adresa.PozivniBroj}`
                                            }

                                            let lok2 = {
                                                X: `${data.Odrediste.X}`,
                                                Y: `${data.Odrediste.Y}`,
                                                Adresa: addr2
                                            }

                                            let kom = {
                                                Opis: `${data.Komentar.Opis}`,
                                                DatumObjave: `${data.Komentar.DatumObjave}`,
                                                IdVoznje: `${data.Komentar.IdVoznje}`,
                                                KorisnickoIme: `${data.Komentar.KorisnickoIme}`,
                                                Ocena: `${data.Komentar.Ocena}`
                                            }

                                            let VoznjaNakonObrade = {
                                                IdVoznje: idVoznja,
                                                DatumVreme: `${data.DatumVreme}`,
                                                Lokacija: lok,
                                                Automobil: `${data.TipAutomobila}`,
                                                Musterija: `${data.Musterija}`,
                                                Odrediste: lok2,
                                                Dispecer: `${localStorage.getItem("Ulogovan")}`,
                                                Vozac: `${dataV.KorisnickoIme}`,
                                                Iznos: `${data.Iznos}`,
                                                Komentar: kom,
                                                StatusVoznje: 2//jer pri obradi voznja postaje obradjena
                                            }

                                            //update voznje
                                            $.ajax({
                                                type: 'PUT',
                                                url: '/api/Voznja/' + idVoznja,//idVoznja je lokalna koja mi cuva samo id voznje izmedju klika na otkazi i klika na dodaj komentar
                                                data: JSON.stringify(VoznjaNakonObrade),
                                                contentType: 'application/json;charset=utf-8',
                                                dataType: 'json',
                                                success: function () {
                                                    alert("Uspešno ste obradili vožnju!");
                                                    $(location).attr('href', 'main.html');
                                                }
                                            })
                    
                                        }
                                    })
                                }
                            }
                        })
                    }
                })

            })

                                /*
                                    for (var i = 0; i < dataV.length; i++) {
                                        if (dataV[i].Zauzet == "NE" && dataV[i].TipAutomobila == ) {


                                            let addr = {
                                                UlicaBroj: `${data.Lokacija.Adresa.UlicaBroj}`,
                                                NaseljenoMesto: `${data.Lokacija.Adresa.NaseljenoMesto}`,
                                                PozivniBroj: `${data.Lokacija.Adresa.PozivniBroj}`
                                            }

                                            let lok = {
                                                X: `${data.Lokacija.X}`,
                                                Y: `${data.Lokacija.Y}`,
                                                Adresa: addr
                                            }

                                            let addr2 = {
                                                UlicaBroj: `${data.Odrediste.Adresa.UlicaBroj}`,
                                                NaseljenoMesto: `${data.Odrediste.Adresa.NaseljenoMesto}`,
                                                PozivniBroj: `${data.Odrediste.Adresa.PozivniBroj}`
                                            }

                                            let lok2 = {
                                                X: `${data.Odrediste.X}`,
                                                Y: `${data.Odrediste.Y}`,
                                                Adresa: addr2
                                            }

                                            let kom = {
                                                Opis: `${data.Komentar.Opis}`,
                                                DatumObjave: `${data.Komentar.DatumObjave}`,
                                                IdVoznje: `${data.Komentar.IdVoznje}`,
                                                KorisnickoIme: `${data.Komentar.KorisnickoIme}`,
                                                Ocena: `${data.Komentar.Ocena}`
                                            }

                                            let VoznjaNakonObrade = {
                                                IdVoznje: idVoznja,
                                                DatumVreme: `${data.DatumVreme}`,
                                                Lokacija: lok,
                                                Automobil: `${data.TipAutomobila}`,
                                                Musterija: `${data.Musterija}`,
                                                Odrediste: lok2,
                                                Dispecer: korisnik.Id,
                                                Vozac: `${dataV[i].Id}`,
                                                Iznos: `${data.Iznos}`,
                                                Komentar: kom,
                                                StatusVoznje: 2//jer pri obradi voznja postaje obradjena
                                            }

                                            //update voznje
                                            $.ajax({
                                                type: 'PUT',
                                                url: '/api/Voznja/' + idVoznja,//idVoznja je lokalna koja mi cuva samo id voznje izmedju klika na otkazi i klika na dodaj komentar
                                                data: JSON.stringify(VoznjaNakonObrade),
                                                contentType: 'application/json;charset=utf-8',
                                                dataType: 'json',
                                                success: function () {
                                                    //sledi update vozaca na zauzet
                                                    let VozacAdresaMenjamStanje = {
                                                        UlicaBroj: `${dataV[i].Lokacija.Adresa.UlicaBroj}`,
                                                        NaseljenoMesto: `${dataV[i].Lokacija.Adresa.NaseljenoMesto}`,
                                                        PozivniBroj: `${dataV[i].Lokacija.Adresa.PozivniBroj}`
                                                    }

                                                    let VozacLokacijaMenjamStanje = {
                                                        X: `${dataV[i].Lokacija.X}`,
                                                        Y: `${dataV[i].Lokacija.Y}`,
                                                        Adresa: VozacAdresaMenjamStanje
                                                    }

                                                    let Auto = {
                                                        IdVozaca: `${dataV[i].Automobil.IdVozaca}`,
                                                        GodisteAutomobila: `${dataV[i].Automobil.GodisteAutomobila}`,
                                                        BrojRegistarskeOznake: `${dataV[i].Automobil.BrojRegistarskeOznake}`,
                                                        BrojTaksiVozila: `${dataV[i].Automobil.BrojTaksiVozila}`,
                                                        TipAutomobila: `${dataV[i].Automobil.TipAutomobila}`
                                                    }

                                                    let NovoStanjeVozac = {
                                                        Id: `${dataV[i].Id}`,
                                                        KorisnickoIme: `${dataV[i].KorisnickoIme}`,
                                                        Lozinka: `${dataV[i].Lozinka}`,
                                                        Ime: `${dataV[i].Ime}`,
                                                        Prezime: `${dataV[i].Prezime}`,
                                                        Pol: `${dataV[i].Pol}`,
                                                        JMBG: `${dataV[i].JMBG}`,
                                                        KontaktTelefon: `${dataV[i].KontaktTelefon}`,
                                                        Email: `${dataV[i].Email}`,
                                                        Uloga: `${dataV[i].Uloga}`,
                                                        Voznje: `${dataV[i].Voznje}`,
                                                        Lokacija: VozacLokacijaMenjamStanje,
                                                        Automobil: Auto,
                                                        Zauzet: "DA"
                                                    }


                                                    $.ajax({
                                                        type: 'PUT',
                                                        url: '/api/Vozac/' + dataV[i].Id,
                                                        data: JSON.stringify(NovoStanjeVozac),
                                                        contentType: 'application/json;charset=utf-8',
                                                        dataType: 'json',
                                                        success: function (data) {
                                                            if (data) {
                                                                alert("Uspešno ste obradili vožnju!");
                                                                $(location).attr('href', 'main.html');
                                                            }
                                                        }
                                                    })
                                                }
                                            })


                                        }
                                    }
                                }
                            }
                                    

                            }
                        } else {
                            alert("Vožnja ne može biti obradjena, jer ne postoji vozač u sistemu!");
                            $(location).attr('href', 'main.html');
                        }*/

       


            //KRAJ KLIK NA DUGME OBRADI U TABELI



            //KRAJ DUGMADI U TABELI

            //KLIK NA DUGME DODAJ KOM
            $('#glavni').on('click', '#dodajKom', function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {

                        for (let i = 0; i < data.length; i++) {

                            if (data[i].IdVoznje == idVoznja) {

                                let addr = {
                                    UlicaBroj: data[i].Lokacija.Adresa.UlicaBroj,
                                    NaseljenoMesto: data[i].Lokacija.Adresa.NaseljenoMesto,
                                    PozivniBroj: data[i].Lokacija.Adresa.PozivniBroj
                                }

                                let lok = {
                                    X: data[i].Lokacija.X,
                                    Y: data[i].Lokacija.Y,
                                    Adresa: addr
                                }

                                let addr2 = {
                                    UlicaBroj: data[i].Odrediste.Adresa.UlicaBroj,
                                    NaseljenoMesto: data[i].Odrediste.Adresa.NaseljenoMesto,
                                    PozivniBroj: data[i].Odrediste.Adresa.PozivniBroj
                                }

                                let lok2 = {
                                    X: data[i].Odrediste.X,
                                    Y: data[i].Odrediste.Y,
                                    Adresa: addr2
                                }

                                let kom = {
                                    Opis: $('#textKom').val(),
                                    IdVoznje: idVoznja,
                                    KorisnickoIme: korisnik.KorisnickoIme,
                                    Ocena: $('#ocene').val()
                                }

                                let KomentarOtkazaneVoznja = {
                                    IdVoznje: idVoznja,
                                    DatumVreme: data[i].DatumVreme,
                                    Lokacija: lok,
                                    Automobil: data[i].Automobil,
                                    Musterija: data[i].Musterija,
                                    Odrediste: lok2,
                                    Dispecer: data[i].Dispecer,
                                    Vozac: data[i].Vozac,
                                    Iznos: data[i].Iznos,
                                    Komentar:kom,
                                    StatusVoznje: 4
                                }

                                $.ajax({
                                    type: 'PUT',
                                    url: '/api/Voznja/' + idVoznja,//idVoznja je lokalna koja mi cuva samo id voznje izmedju klika na otkazi i klika na dodaj komentar
                                    data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function () {
                                        alert("Uspešno ste otkazali vožnju!");
                                        $(location).attr('href', 'main.html');
                                    }
                                })
                            }
                        }
                    }
                })
            })
            //KRAJ KLIK NA DUGME DODAJ KOM

            //KLIK NA DUGME IZMENI VOZNJU

            $('#glavni').on('click', '#izmeniVoznju', function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {

                        for (let i = 0; i < data.length; i++) {

                            if (data[i].IdVoznje == idVoznja) {

                                let tipAutomobila;

                                if ($('#izmenaTipAuta1').prop('checked')) {
                                    tipAutomobila = 0;
                                } else if ($('#izmenaTipAuta2').prop('checked')) {
                                    tipAutomobila = 1;
                                } else {
                                    tipAutomobila = 2;
                                }

                                let addr = {
                                    UlicaBroj: $('#izmenaUlicaBroj').val(),
                                    NaseljenoMesto: $('#izmenaNaseljenoMesto').val(),
                                    PozivniBroj: $('#izmenaPozivniBroj').val()
                                }

                                let lok = {
                                    X: $('#izmenaKoordinataX').val(),
                                    Y: $('#izmenaKoordinataY').val(),
                                    Adresa: addr
                                }

                                let addr2 = {
                                    UlicaBroj: data[i].Odrediste.Adresa.UlicaBroj,
                                    NaseljenoMesto: data[i].Odrediste.Adresa.NaseljenoMesto,
                                    PozivniBroj: data[i].Odrediste.Adresa.PozivniBroj
                                }

                                let lok2 = {
                                    X: data[i].Odrediste.X,
                                    Y: data[i].Odrediste.Y,
                                    Adresa: addr2
                                }

                                let kom = {
                                    Opis: data[i].Komentar.Opis,
                                    DatumObjave: data[i].Komentar.DatumObjave,
                                    IdVoznje: data[i].Komentar.IdVoznje,
                                    KorisnickoIme: data[i].Komentar.KorisnickoIme,
                                    Ocena: data[i].Komentar.Ocena
                                }

                                let KomentarOtkazaneVoznja = {
                                    IdVoznje: idVoznja,
                                    DatumVreme: data[i].DatumVreme,
                                    Lokacija: lok,
                                    Automobil: tipAutomobila,
                                    Musterija: data[i].Musterija,
                                    Odrediste: lok2,
                                    Dispecer: data[i].Dispecer,
                                    Vozac: data[i].Vozac,
                                    Iznos: data[i].Iznos,
                                    Komentar: kom,
                                    StatusVoznje: 0//jer pri izmeni voznja ostaje u statusu kreirana
                                }

                                $.ajax({
                                    type: 'PUT',
                                    url: '/api/Voznja/' + idVoznja,//idVoznja je lokalna koja mi cuva samo id voznje izmedju klika na otkazi i klika na dodaj komentar
                                    data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function () {
                                        alert("Uspešno ste izmenili vožnju!");
                                        $(location).attr('href', 'main.html');
                                    }
                                })
                            }
                        }
                    }
                })

            })

            //KRAJ KLIK NA DUGME IZMENI VOZNJU

            //KLIK NA LINK DODAJ NOVU VOZNJU (DISPECERRRRR)
            $('#nV').click(function () {
                $('#glavni2').hide();

                let s = '';
                s += '<div id="divNovaVoznjaDispecer">';
                s += '  <table style="position:absolute;margin-left:3%;margin-top:3%;">';
                s += '     <tr ><th colspan="2">Unesite podatke o novoj vožnji:</th></tr>';
                s += '    <tr ><td colsapn="2"><hr /></td></tr>';
                s += '    <tr><td >Koordinata X:</td><td><input type="text" style="margin:5px;" name="korisnikLokacijaXDispecer" id="korisnikLokacijaXDispecer" /></td></tr';
                s += '    <tr><td>Koordinata Y:</td><td><input type="text" style="margin:5px;" name="korisnikLokacijaYDispecer" id="korisnikLokacijaYDispecer" /></td></tr>';
                s += '    <tr><td>Ulica i broj:</td><td><input type="text" style="margin:5px;" name="korisnikUlicaBrojDispecer" id="korisnikUlicaBrojDispecer" /></td></tr>';
                s += '     <tr><td>Naseljeno mesto:</td><td><input type="text" style="margin:5px;" name="korisnikNaseljenoMestoDispecer" id="korisnikNaseljenoMestoDispecer" /></td></tr>';
                s += '     <tr><td>Pozivni broj:</td><td><input type="text" style="margin:5px;" name="korisnikPozivniBrojDispecer" id="korisnikPozivniBrojDispecer" /></td></tr>';
                s += '     <tr><td>Željeni tip automobila:</td><td><label>&nbspPutnički:&nbsp&nbsp</label><input type="radio" style="margin:5px;" name="korisnikTipAutaDispecer" value="Putnicki" id="korisnikTipAutaDispecer1" /><label>&nbsp&nbspKombi:&nbsp&nbsp</label><input type="radio" value="Kombi" style="margin:5px;" name="korisnikTipAutaDispecer" id="korisnikTipAutaDispecer2" /></td></tr>';
                s += '     <tr><td colspan="2" align="right"><input type="button" style="margin:5px;" name="DodajVozacaDispecer" id="DodajVozacaDispecer" value="Dodaj vozača" /></td></tr>';
                s += ' </table>';
                s += ' </div>';

                $('#glavni2').html(s);

                $('#glavni2').fadeIn(500);
            })

            $('#glavni2').on('click', '#DodajVozacaDispecer', function () {
                $('#DodajVozacaDispecer').hide();

                let s = '';
                s += `<div style="position:absolute;"><h3>Moguć izbor vozača:</h3><br>Vozacev username: <select name="slobodniV" id="slobodniV">`;
                let usao = "ne";

                let tip;
                if ($('#korisnikTipAutaDispecer1').prop('checked')) {
                    tip = 'Putnicki';
                } else if ($('#korisnikTipAutaDispecer2').prop('checked')) {
                    tip = 'Kombi';
                } else {
                    tip = 'Svejedno';
                }

                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    // data: JSON.stringify(KomentarOtkazaneVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data.length > 0) {
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].Zauzet == "NE") {
                                    if (tip == "Svejedno") {
                                        s += `<option value=${data[i].KorisnickoIme}>${data[i].KorisnickoIme}</option>`;
                                        usao = "da";
                                    } else if (tip == vratiVozilo(data[i].Automobil.TipAutomobila)) {
                                        s += `<option value=${data[i].KorisnickoIme}>${data[i].KorisnickoIme}</option>`;
                                        usao = "da";
                                    }
                                }
                            }
                            if (usao == "da") {
                                s += '</select>';
                                s += '     <input type="button" style="margin:5px;" name="DodajVoznjuDispecer" id="DodajVoznjuDispecer" value="Dodaj" /></div>';

                                $('#glavni2').append(s);
                                $('#glavni2').fadeIn(500);
                            } else {
                                alert("Nema odgovarajućeg vozača!");
                                $(location).attr('href', 'main.html');
                            }
                        } else {
                            alert("Nema vozača u sistemu!");
                            $(location).attr('href', 'main.html');
                        }
                    }
                })
            })

            $('#glavni2').on('click', '#DodajVoznjuDispecer', function () {
                let odabranVozac = $('#slobodniV').prop('value');


                let tipAutomobila;

                if ($('#korisnikTipAutaDispecer1').prop('checked')) {
                    tipAutomobila = 'Putnicki';
                } else if ($('#korisnikTipAutaDispecer2').prop('checked')) {
                    tipAutomobila = 'Kombi';
                } else {
                    tipAutomobila = 'Svejedno';
                }
                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    data: { KorisnickoIme: `${odabranVozac}` },
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (dataV) {

                        let VozacAdresaMenjamStanje = {
                            UlicaBroj: `${dataV.Lokacija.Adresa.UlicaBroj}`,
                            NaseljenoMesto: `${dataV.Lokacija.Adresa.NaseljenoMesto}`,
                            PozivniBroj: `${dataV.Lokacija.Adresa.PozivniBroj}`
                        }

                        let VozacLokacijaMenjamStanje = {
                            X: `${dataV.Lokacija.X}`,
                            Y: `${dataV.Lokacija.Y}`,
                            Adresa: VozacAdresaMenjamStanje
                        }

                        let Auto = {
                            IdVozaca: `${dataV.Automobil.IdVozaca}`,
                            GodisteAutomobila: `${dataV.Automobil.GodisteAutomobila}`,
                            BrojRegistarskeOznake: `${dataV.Automobil.BrojRegistarskeOznake}`,
                            BrojTaksiVozila: `${dataV.Automobil.BrojTaksiVozila}`,
                            TipAutomobila: `${dataV.Automobil.TipAutomobila}`
                        }

                        let NovoStanjeVozac = {
                            Id: `${dataV.Id}`,
                            KorisnickoIme: `${dataV.KorisnickoIme}`,
                            Lozinka: `${dataV.Lozinka}`,
                            Ime: `${dataV.Ime}`,
                            Prezime: `${dataV.Prezime}`,
                            Pol: `${dataV.Pol}`,
                            JMBG: `${dataV.JMBG}`,
                            KontaktTelefon: `${dataV.KontaktTelefon}`,
                            Email: `${dataV.Email}`,
                            Uloga: `${dataV.Uloga}`,
                            Voznje: `${dataV.Voznje}`,
                            Banovan: `${"NE"}`,
                            Lokacija: VozacLokacijaMenjamStanje,
                            Automobil: Auto,
                            Zauzet: "DA"//jer mu je upravo voznja dodeljena od strane dispecera
                        }

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Vozac/' + dataV.Id,
                            data: JSON.stringify(NovoStanjeVozac),
                            contentType: 'application/json;charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {

                                    let AdresaKorisnikDodajeVoznju = {
                                        UlicaBroj: `${$('#korisnikUlicaBrojDispecer').val()}`,
                                        NaseljenoMesto: `${$('#korisnikNaseljenoMestoDispecer').val()}`,
                                        PozivniBroj: `${$('#korisnikPozivniBrojDispecer').val()}`
                                    }

                                    let LokacijaKorisnikDodajeVoznju = {
                                        X: `${$('#korisnikLokacijaXDispecer').val()}`,
                                        Y: `${$('#korisnikLokacijaYDispecer').val()}`,
                                        Adresa: AdresaKorisnikDodajeVoznju
                                    }

                                    let AdresaKorisnikDodajeVoznju2 = {
                                        UlicaBroj: "",
                                        NaseljenoMesto: "",
                                        PozivniBroj: ""
                                    }

                                    let LokacijaKorisnikDodajeVoznju2 = {
                                        X: "",
                                        Y: "",
                                        Adresa: AdresaKorisnikDodajeVoznju2
                                    }

                                    let komentar = {
                                        Opis: "",
                                        DatumObjave: "",
                                        KorisnickoIme: "",
                                        IdVoznje: "",
                                        Ocena: ""
                                    }

                                    let NovaVoznjaDispecera = {
                                        IdVoznje: "",
                                        DatumVreme: "",
                                        Lokacija: LokacijaKorisnikDodajeVoznju,
                                        Automobil: tipAutomobila,
                                        Musterija: "",
                                        Odrediste: LokacijaKorisnikDodajeVoznju2,
                                        Dispecer: `${localStorage.getItem("Ulogovan")}`,
                                        Vozac: dataV.KorisnickoIme,
                                        Iznos: "",
                                        Komentar: komentar,
                                        StatusVoznje: 1 //status voznje je formirana
                                    }

                                    $.ajax({
                                        type: 'POST',
                                        url: '/api/Voznja',
                                        data: JSON.stringify(NovaVoznjaDispecera),
                                        contentType: 'application/json;charset=utf-8',
                                        dataType: 'json',
                                        success: function (data) {
                                            if (data) {
                                                alert("Vožnja uspešno kreirana!");
                                                $(location).attr('href', 'main.html');
                                            }
                                        }
                                    })
                                }
                            }
                        })
                    }
                })
            })


            //KLIK NA DUGME U TABELI VOZACA USPESNA
            $(document).on('click', '.uspesnabtn', function () {
                let idVoznje = $(this).prop('name');
                idVoznja = idVoznje;
                //otvaram novi prozor za unos odredista i iznosa para

                let s = '';

                s += '<div>';
                s += `<table style="position:absolute;"><tr><th colspan="2" ><h2><b>Kraj vožnje</b></h2></th></tr>`;
                s += `<tr><th colspan="2"><h3>Unesite informacije o vožnji:</h3></th></tr>`;
                s += '<tr><th>Odredište X:</th><td><input type="text" name="konacnoX" id="konacnoX" style="margin:5px"/></td></tr>';
                s += '<tr><th>Odredište Y:</th><td><input type="text" name="konacnoY" id="konacnoY" style="margin:5px"/></td></tr>';
                s += '<tr><th>Ulica i broj:</th><td><input type="text" name="konacnoUlicaBroj" id="konacnoUlicaBroj" style="margin:5px"/></td></tr>';
                s += '<tr><th>Naseljeno mesto:</th><td><input type="text" name="konacnoNaseljenoMesto" id="konacnoNaseljenoMesto" style="margin:5px"/></td></tr>';
                s += '<tr><th>Pozivni broj:</th><td><input type="text" name="konacnoPozivniBroj" id="konacnoPozivniBroj" style="margin:5px"/></td></tr>';
                s += '<tr><th>Iznos novca:</th><td><input type="text" name="konacnoIznos" id="konacnoIznos" style="margin:5px"/></td></tr>';
                s += '<tr><td colspan="2" align="right"><input type="button" name="konacnoDodaj" id="konacnoDodaj" value="Završi"/></td></tr></table>';
                s += '</div>';

                $('#glavni3').hide();
                $('#glavni3').html(s);
                $('#glavni3').fadeIn(500);
            })

            $('#glavni3').on('click', '#konacnoDodaj', function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja/' + idVoznja,
                    //data: JSON.stringify({ "Id": `${idVoznja}` }),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        let addr = {
                            UlicaBroj: `${data.Lokacija.Adresa.UlicaBroj}`,
                            NaseljenoMesto: `${data.Lokacija.Adresa.NaseljenoMesto}`,
                            PozivniBroj: `${data.Lokacija.Adresa.PozivniBroj}`
                        }

                        let lok = {
                            X: `${data.Lokacija.X}`,
                            Y: `${data.Lokacija.Y}`,
                            Adresa: addr
                        }

                        let addr2 = {
                            UlicaBroj: `${$('#konacnoUlicaBroj').val()}`,
                            NaseljenoMesto: `${$('#konacnoNaseljenoMesto').val()}`,
                            PozivniBroj: `${$('#konacnoPozivniBroj').val()}`
                        }

                        let lok2 = {
                            X: `${$('#konacnoX').val()}`,
                            Y: `${$('#konacnoY').val()}`,
                            Adresa: addr2
                        }

                        let kom = {
                            Opis: `${data.Komentar.Opis}`,
                            DatumObjave: `${data.Komentar.DatumObjave}`,
                            IdVoznje: `${data.Komentar.IdVoznje}`,
                            KorisnickoIme: `${data.Komentar.KorisnickoIme}`,
                            Ocena: `${data.Komentar.Ocena}`
                        }

                        let VoznjaNakonObrade = {
                            IdVoznje: `${data.IdVoznje}`,
                            DatumVreme: `${data.DatumVreme}`,
                            Lokacija: lok,
                            Automobil: `${data.TipAutomobila}`,
                            Musterija: `${data.Musterija}`,
                            Odrediste: lok2,
                            Dispecer: `${data.Dispecer}`,
                            Vozac: `${data.Vozac}`,
                            Iznos: `${$('#konacnoIznos').val()}`,
                            Komentar: kom,
                            StatusVoznje: 6//jer pri zavrsetku postaje uspesna (ako je kliknuto uspesno sto u ovom slucaju jeste)
                        }

                        //update voznje
                            $.ajax({
                            type: 'PUT',
                            url: '/api/Voznja/' + idVoznja,//idVoznja je lokalna koja mi cuva samo id voznje izmedju klika na otkazi i klika na dodaj komentar
                            data: JSON.stringify(VoznjaNakonObrade),
                            contentType: 'application/json;charset=utf-8',
                            dataType: 'json',
                                success: function () {
                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Vozac',
                                        data: { KorisnickoIme: `${korisnik.KorisnickoIme}` },
                                        contentType: 'application/json;charset=utf-8',
                                        dataType: 'json',
                                        success: function (dataV) {
                                            let VozacAdresaMenjamStanje = {
                                                UlicaBroj: `${dataV.Lokacija.Adresa.UlicaBroj}`,
                                                NaseljenoMesto: `${dataV.Lokacija.Adresa.NaseljenoMesto}`,
                                                PozivniBroj: `${dataV.Lokacija.Adresa.PozivniBroj}`
                                            }

                                            let VozacLokacijaMenjamStanje = {
                                                X: `${dataV.Lokacija.X}`,
                                                Y: `${dataV.Lokacija.Y}`,
                                                Adresa: VozacAdresaMenjamStanje
                                            }

                                            let Auto = {
                                                IdVozaca: `${dataV.Automobil.IdVozaca}`,
                                                GodisteAutomobila: `${dataV.Automobil.GodisteAutomobila}`,
                                                BrojRegistarskeOznake: `${dataV.Automobil.BrojRegistarskeOznake}`,
                                                BrojTaksiVozila: `${dataV.Automobil.BrojTaksiVozila}`,
                                                TipAutomobila: `${dataV.Automobil.TipAutomobila}`
                                            }

                                            let NovoStanjeVozac = {
                                                Id: `${dataV.Id}`,
                                                KorisnickoIme: `${dataV.KorisnickoIme}`,
                                                Lozinka: `${dataV.Lozinka}`,
                                                Ime: `${dataV.Ime}`,
                                                Prezime: `${dataV.Prezime}`,
                                                Pol: `${dataV.Pol}`,
                                                JMBG: `${dataV.JMBG}`,
                                                KontaktTelefon: `${dataV.KontaktTelefon}`,
                                                Email: `${dataV.Email}`,
                                                Uloga: `${dataV.Uloga}`,
                                                Voznje: `${dataV.Voznje}`,
                                                Banovan: `${"NE"}`,
                                                Lokacija: VozacLokacijaMenjamStanje,
                                                Automobil: Auto,
                                                Zauzet: "NE"
                                            }


                                            $.ajax({
                                                type: 'PUT',
                                                url: '/api/Vozac/' + dataV.Id,
                                                data: JSON.stringify(NovoStanjeVozac),
                                                contentType: 'application/json;charset=utf-8',
                                                dataType: 'json',
                                                success: function (data) {
                                                    alert("Uspešno ste završili vožnju!");
                                                    $(location).attr('href', 'main.html');
                                                }
                                            })
                                        }
                                    })
                                }
                            })
                      
                        
                    }
                })
            })

           //KLIK NA DUGME U TABELI VOZACA USPESNA


            //KLIK NA DUGME NEUSPESNA U TABELI VOZACA
            $(document).on('click', '.neuspesnabtn', function () {
                let idVoznje = $(this).prop('name');
                idVoznja = idVoznje;

                $('#glavni3').hide();
                let s = '';
                s += '<div class="komentar">';
                s += '<table style="position:absolute;"><tr><td colspan="2"><label>Obavezno unesite komentar:</label></td></tr>';
                s += '<tr><td colspan="2"><textarea name="komentarNeuspesna" id="komentarNeuspesna" cols="30" rows="5" placeholder="Ovde unesite komentar" /></td></tr>';
                s += '<tr><td>Odaberite ocenu:</td><td><select name="komentarNeuspesnaOcene" id="komentarNeuspesnaOcene"><option value="0" data-toggle="tooltip" title="Ne želim da ocenim">0</option><option value="1" data-toggle="tooltip" title="Jako loše">1</option><option value="2" data-toggle="tooltip" title="Loše">2</option><option value="3" data-toggle="tooltip" title="Dobro">3</option><option value="4" data-toggle="tooltip" title="Vrlo dobro">4</option><option value="5" data-toggle="tooltip" title="Odlično">5</option></select></td></tr>';
                s += '<tr><td colspan="2"><input type="button" name="dodajKomNeuspesna" id="dodajKomNeuspesna" value="U redu"/></td></tr></table></div>';
                $('#glavni3').html(s);
                $('#glavni3').fadeIn(500);
            })

            $('#glavni3').on('click', '#dodajKomNeuspesna', function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {

                        for (let i = 0; i < data.length; i++) {

                            if (data[i].IdVoznje == idVoznja) {

                                let addr = {
                                    UlicaBroj: `${data[i].Lokacija.Adresa.UlicaBroj}`,
                                    NaseljenoMesto: `${data[i].Lokacija.Adresa.NaseljenoMesto}`,
                                    PozivniBroj: `${data[i].Lokacija.Adresa.PozivniBroj}`
                                }

                                let lok = {
                                    X: `${data[i].Lokacija.X}`,
                                    Y: `${data[i].Lokacija.Y}`,
                                            Adresa: addr
                                }

                                let addr2 = {
                                    UlicaBroj: `${data[i].Odrediste.Adresa.UlicaBroj}`,
                                    NaseljenoMesto: `${data[i].Odrediste.Adresa.NaseljenoMesto}`,
                                    PozivniBroj: `${data[i].Odrediste.Adresa.PozivniBroj}`
                                }

                                let lok2 = {
                                    X: `${data[i].Odrediste.X}`,
                                    Y: `${data[i].Odrediste.Y}`,
                                    Adresa: addr2
                                }

                                let kom = {
                                    Opis: `${$('#komentarNeuspesna').val()}`,
                                    IdVoznje: `${idVoznja}`,
                                    KorisnickoIme: `${korisnik.KorisnickoIme}`,
                                    Ocena: $('#komentarNeuspesnaOcene').val()
                                }

                                let KomentarOtkazaneVoznja = {
                                    IdVoznje: `${idVoznja}`,
                                    DatumVreme: `${data[i].DatumVreme}`,
                                    Lokacija: lok,
                                    Automobil: `${data[i].Automobil}`,
                                    Musterija: `${data[i].Musterija}`,
                                    Odrediste: lok2,
                                    Dispecer: `${data[i].Dispecer}`,
                                    Vozac: `${data[i].Vozac}`,
                                    Iznos: `${data[i].Iznos}`,
                                    Komentar: kom,
                                    StatusVoznje: 5//voznja je neuspesna i to se update
                                }

                                $.ajax({
                                    type: 'PUT',
                                    url: '/api/Voznja/' + idVoznja,//idVoznja je lokalna koja mi cuva samo id voznje izmedju klika na otkazi i klika na dodaj komentar
                                    data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function () {

                                        //moram update vozaca da je slobodan
                                        $.ajax({
                                            type: 'GET',
                                            url: '/api/Vozac',
                                            data: { KorisnickoIme: `${korisnik.KorisnickoIme}` },
                                            contentType: 'application/json;charset=utf-8',
                                            dataType: 'json',
                                            success: function (dataV) {
                                                let VozacAdresaMenjamStanje = {
                                                    UlicaBroj: `${dataV.Lokacija.Adresa.UlicaBroj}`,
                                                    NaseljenoMesto: `${dataV.Lokacija.Adresa.NaseljenoMesto}`,
                                                    PozivniBroj: `${dataV.Lokacija.Adresa.PozivniBroj}`
                                                }

                                                let VozacLokacijaMenjamStanje = {
                                                    X: `${dataV.Lokacija.X}`,
                                                    Y: `${dataV.Lokacija.Y}`,
                                                    Adresa: VozacAdresaMenjamStanje
                                                }

                                                let Auto = {
                                                    IdVozaca: `${dataV.Automobil.IdVozaca}`,
                                                    GodisteAutomobila: `${dataV.Automobil.GodisteAutomobila}`,
                                                    BrojRegistarskeOznake: `${dataV.Automobil.BrojRegistarskeOznake}`,
                                                    BrojTaksiVozila: `${dataV.Automobil.BrojTaksiVozila}`,
                                                    TipAutomobila: `${dataV.Automobil.TipAutomobila}`
                                                }

                                                let NovoStanjeVozac = {
                                                    Id: `${dataV.Id}`,
                                                    KorisnickoIme: `${dataV.KorisnickoIme}`,
                                                    Lozinka: `${dataV.Lozinka}`,
                                                    Ime: `${dataV.Ime}`,
                                                    Prezime: `${dataV.Prezime}`,
                                                    Pol: `${dataV.Pol}`,
                                                    JMBG: `${dataV.JMBG}`,
                                                    KontaktTelefon: `${dataV.KontaktTelefon}`,
                                                    Email: `${dataV.Email}`,
                                                    Uloga: `${dataV.Uloga}`,
                                                    Voznje: `${dataV.Voznje}`,
                                                    Banovan: `${"NE"}`,
                                                    Lokacija: VozacLokacijaMenjamStanje,
                                                    Automobil: Auto,
                                                    Zauzet: "NE"
                                                }


                                                $.ajax({
                                                    type: 'PUT',
                                                    url: '/api/Vozac/' + dataV.Id,
                                                    data: JSON.stringify(NovoStanjeVozac),
                                                    contentType: 'application/json;charset=utf-8',
                                                    dataType: 'json',
                                                    success: function (data) {
                                                        alert("Uspešno ste postavili status vožnje na neuspešna!");
                                                        $(location).attr('href', 'main.html');
                                                    }
                                                })
                                            }
                                        })
                                    }

                                })

                                break;//samo jednom cim je nadje vise nema potrebe da prolazi forom
                            }
                            
                        }
                    }
                })
            })

            //KRAJ KLIK NA DUGME NEUSPESNA U TABELI VOZACA


            //KLIK NA DUGME KOMENTAR U TABELI KOD KORISNIKA NAKON STO JE VOZNJA USPESNA
            $(document).on('click', '.kombtn', function () {
                let idVoznje = $(this).prop('name');
                idVoznja = idVoznje;

                $('#glavni').hide();
                let s = '';
                s += '<div class="komentar">';
                s += '<table style="position:absolute;"><tr><td colspan="2"><label>Ovde možete ostaviti komentar:</label></td></tr>';
                s += '<tr><td colspan="2"><textarea name="uspesanKomentar" id="uspesanKomentar" cols="30" rows="5" placeholder="Ovde unesite komentar" /></td></tr>';
                s += '<tr><td>Odaberite ocenu:</td><td><select name="oceneUspesanKomentar" id="oceneUspesanKomentar"><option value="0" data-toggle="tooltip" title="Ne želim da ocenim">0</option><option value="1" data-toggle="tooltip" title="Jako loše">1</option><option value="2" data-toggle="tooltip" title="Loše">2</option><option value="3" data-toggle="tooltip" title="Dobro">3</option><option value="4" data-toggle="tooltip" title="Vrlo dobro">4</option><option value="5" data-toggle="tooltip" title="Odlično">5</option></select></td></tr>';
                s += '<tr><td colspan="2"><input type="button" name="dodajUspesanKomentar" id="dodajUspesanKomentar" value="U redu"/></td></tr></table></div>';
                $('#glavni').html(s);
                $('#glavni').fadeIn(500);

            })

            $('#glavni').on('click', '#dodajUspesanKomentar', function () {
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {

                        for (let i = 0; i < data.length; i++) {

                            if (data[i].IdVoznje == idVoznja) {

                                let addr = {
                                    UlicaBroj: `${data[i].Lokacija.Adresa.UlicaBroj}`,
                                    NaseljenoMesto: `${data[i].Lokacija.Adresa.NaseljenoMesto}`,
                                    PozivniBroj: `${data[i].Lokacija.Adresa.PozivniBroj}`
                                }

                                let lok = {
                                    X: `${data[i].Lokacija.X}`,
                                    Y: `${data[i].Lokacija.Y}`,
                                    Adresa: addr
                                }

                                let addr2 = {
                                    UlicaBroj: `${data[i].Odrediste.Adresa.UlicaBroj}`,
                                    NaseljenoMesto: `${data[i].Odrediste.Adresa.NaseljenoMesto}`,
                                    PozivniBroj: `${data[i].Odrediste.Adresa.PozivniBroj}`
                                }

                                let lok2 = {
                                    X: `${data[i].Odrediste.X}`,
                                    Y: `${data[i].Odrediste.Y}`,
                                    Adresa: addr2
                                }

                                let kom = {
                                    Opis: `${$('#uspesanKomentar').val()}`,
                                    IdVoznje: `${idVoznja}`,
                                    KorisnickoIme: `${localStorage.getItem("Ulogovan")}`,
                                    Ocena: `${$('#oceneUspesanKomentar').val()}`
                                }

                                let KomentarOtkazaneVoznja = {
                                    IdVoznje: `${idVoznja}`,
                                    DatumVreme: `${data[i].DatumVreme}`,
                                    Lokacija: lok,
                                    Automobil: `${data[i].Automobil}`,
                                    Musterija: `${data[i].Musterija}`,
                                    Odrediste: lok2,
                                    Dispecer: `${data[i].Dispecer}`,
                                    Vozac: `${data[i].Vozac}`,
                                    Iznos: `${data[i].Iznos}`,
                                    Komentar: kom,
                                    StatusVoznje: `${data[i].StatusVoznje}`
                                }

                                $.ajax({
                                    type: 'PUT',
                                    url: '/api/Voznja/' + idVoznja,//idVoznja je lokalna koja mi cuva samo id voznje izmedju klika na otkazi i klika na dodaj komentar
                                    data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function () {
                                        alert("Uspešno ste komentarisali vožnju!");
                                        $(location).attr('href', 'main.html');
                                    }
                                })
                            }
                        }
                    }
                })

            })
            
            //KRAJ KLIK NA DUGME KOMENTAR U TABELI KOD KORISNIKA NAKON STO JE VOZNJA USPESNA

            let prvi;
            $('#pretragaVozac').click(function () {
                let s = '';
                prvi = "da";

                s += '<div style="position:relative;"><table style="position:absolute;margin-left:50%;margin-top:60px;margin-right:-50%;transform: translate(-50%, -50%)"><tr><th colspan="3" ><h3>Ovde možete izvršiti pretragu vožnji</h3></th></tr>';
                s += '<tr><td  data-balloon="Neki od parametara može ostati prazan!" data-balloon-pos="down" ><input type="text" name="imeVozacaPretraga" id="imeVozacaPretraga" placeholder="Ime vozača" style="margin:5px"/></td><td  data-balloon="Neki od parametara može ostati prazan!" data-balloon-pos="down" ><input type="text" name="prezimeVozacaPretraga" id="prezimeVozacaPretraga" placeholder="Prezime vozača" style="margin:5px"/></td>';
                s += '<td colspan="2" align="right" data-balloon="Izvrši pretragu!" data-balloon-pos="down"><input type="button" name="pretraziVozaca" id="pretraziVozaca" value="Traži" style="margin:5px" /></td></tr>';
                s += '</table></div>';


                $('#glavni2').hide();
                $('#glavni2').html(s);
                $('#glavni2').fadeIn(500);
                
            })

            $('#glavni2').on('click', '#pretraziVozaca', function () {
                let s = '';
                s += '<div>';
                let niz = [];

                let slucaj;
                

                if (`${$('#imeVozacaPretraga').val()}` == "" && `${$('#prezimeVozacaPretraga').val()}` == "") {
                    slucaj = 0;
                } else if (`${$('#imeVozacaPretraga').val()}` != "" && `${$('#prezimeVozacaPretraga').val()}` == "") {
                    //punim niz svim Korisnickim Imenima koja su od ovog imena
                    slucaj = 1;
                } else if (`${$('#imeVozacaPretraga').val()}` == "" && `${$('#prezimeVozacaPretraga').val()}` != "") {
                    //punim niz svim Korisnickim Imenima koja su od ovog prezimena
                    slucaj = 2;
                } else if (`${$('#imeVozacaPretraga').val()}` != "" && `${$('#prezimeVozacaPretraga').val()}` != "") {
                    //punim niz svim Korisnickim Imenima koja su od ovog prezimena i imena
                    slucaj = 3;
                }


                $.ajax({
                    type: 'GET',
                    url: '/api/Vozac',
                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (dataV) {
                        if (dataV.length > 0) {
                            if (slucaj == 0) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10" data-balloon="Kako niste odabrali parametre, vraćamo vam celu listu!" data-balloon-pos="up"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';


                                        for (let i = 0; i < data.length; i++) {
                                            s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                            if (data[i].Musterija == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Musterija + '</td>');
                                            }

                                            if (data[i].Vozac == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Vozac + '</td>');
                                            }

                                            s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                            switch (data[i].Automobil) {
                                                case 0:
                                                    s += "Putnički";
                                                    break;
                                                case 1:
                                                    s += "Kombi";
                                                    break;
                                                case 2:
                                                    s += "Svejedno";
                                            }

                                            if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                                s += ("</td><td>/" + "</td>");
                                            }
                                            else {
                                                s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                            }

                                            if (data[i].Iznos != "0") {
                                                s += ("<td>" + data[i].Iznos + "</td>");
                                            } else {
                                                s += ("<td>/</td>");
                                            }

                                            s += ('<td><textarea rows="5" cols="30" disabled>');

                                            if (data[i].Komentar.Opis == "") {
                                                s += ("Komentar nije dodat!" + "</textarea ></td >");
                                            } else {
                                                s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                            }

                                            s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> </tr>");


                                        }
                                        s += '</table>';
                                        if (prvi == "da") {
                                            $('#glavni2').append(s);
                                            prvi = "ne";
                                        } else {
                                            $('.voznje').replaceWith(s);
                                        }
                                    }
                                })
                                
                            } else if (slucaj == 1) {
                                for (var i = 0; i < dataV.length; i++) {
                                    if (dataV[i].Ime == `${$('#imeVozacaPretraga').val()}`) {
                                        niz.push(dataV[i].KorisnickoIme);
                                    }
                                }

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                        let konacno = uporedi(niz, data);

                                        if (konacno.length > 0) {
                                            for (let i = 0; i < konacno.length; i++) {
                                              
                                                s += ("<tr><td>" + konacno[i].IdVoznje + "</td><td>" + konacno[i].DatumVreme + "</td>");

                                                if (konacno[i].Musterija == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Musterija + '</td>');
                                                }

                                                if (konacno[i].Vozac == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Vozac + '</td>');
                                                }

                                                s += ('<td>' + konacno[i].Lokacija.Adresa.UlicaBroj + ", " + konacno[i].Lokacija.Adresa.NaseljenoMesto + " " + konacno[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                                switch (konacno[i].Automobil) {
                                                    case 0:
                                                        s += "Putnički";
                                                        break;
                                                    case 1:
                                                        s += "Kombi";
                                                        break;
                                                    case 2:
                                                        s += "Svejedno";
                                                }

                                                if (konacno[i].Odrediste.Adresa.UlicaBroj == "") {
                                                    s += ("</td><td>/" + "</td>");
                                                }
                                                else {
                                                    s += ("</td><td>" + konacno[i].Odrediste.Adresa.UlicaBroj + ", " + konacno[i].Odrediste.Adresa.NaseljenoMesto + " " + konacno[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                                }

                                                if (konacno[i].Iznos != "0") {
                                                    s += ("<td>" + konacno[i].Iznos + "</td>");
                                                } else {
                                                    s += ("<td>/</td>");
                                                }

                                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                                if (konacno[i].Komentar.Opis == "") {
                                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                                } else {
                                                    s += ("Korisnicko ime: " + konacno[i].Komentar.KorisnickoIme + "\n\nOpis: " + konacno[i].Komentar.Opis + "\n\nOcena: " + konacno[i].Komentar.Ocena + "\nDatum: " + konacno[i].Komentar.DatumObjave + "</textarea ></td >");
                                                }

                                                s += ("<td>" + vratiStatusVoznje(konacno[i].StatusVoznje) + "</td></tr>");

                                               
                                            }

                                            s += '</table>';
                                            if (prvi == "da") {
                                                $('#glavni2').append(s);
                                                prvi = "ne";
                                            } else {
                                                // $('.voznje').hide();
                                                $('.voznje').replaceWith(s);
                                            }
                                        } else {
                                            alert("Sa imenom " + `${$('#imeVozacaPretraga').val()}` + " nije pronadjena ni jedna vožnja!");
                                            $(location).attr('href', 'main.html');
                                        }
                                    }
                                })
                            
                            
                                } else if (slucaj == 2) {
                                for (var i = 0; i < dataV.length; i++) {
                                    if (dataV[i].Prezime == `${$('#prezimeVozacaPretraga').val()}`) {
                                        niz.push(dataV[i].KorisnickoIme);
                                    }
                                }

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                        let konacno = uporedi(niz, data);

                                        if (konacno.length > 0) {
                                            for (let i = 0; i < konacno.length; i++) {

                                                s += ("<tr><td>" + konacno[i].IdVoznje + "</td><td>" + konacno[i].DatumVreme + "</td>");

                                                if (konacno[i].Musterija == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Musterija + '</td>');
                                                }

                                                if (konacno[i].Vozac == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Vozac + '</td>');
                                                }

                                                s += ('<td>' + konacno[i].Lokacija.Adresa.UlicaBroj + ", " + konacno[i].Lokacija.Adresa.NaseljenoMesto + " " + konacno[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                                switch (konacno[i].Automobil) {
                                                    case 0:
                                                        s += "Putnički";
                                                        break;
                                                    case 1:
                                                        s += "Kombi";
                                                        break;
                                                    case 2:
                                                        s += "Svejedno";
                                                }

                                                if (konacno[i].Odrediste.Adresa.UlicaBroj == "") {
                                                    s += ("</td><td>/" + "</td>");
                                                }
                                                else {
                                                    s += ("</td><td>" + konacno[i].Odrediste.Adresa.UlicaBroj + ", " + konacno[i].Odrediste.Adresa.NaseljenoMesto + " " + konacno[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                                }

                                                if (konacno[i].Iznos != "0") {
                                                    s += ("<td>" + konacno[i].Iznos + "</td>");
                                                } else {
                                                    s += ("<td>/</td>");
                                                }

                                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                                if (konacno[i].Komentar.Opis == "") {
                                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                                } else {
                                                    s += ("Korisnicko ime: " + konacno[i].Komentar.KorisnickoIme + "\n\nOpis: " + konacno[i].Komentar.Opis + "\n\nOcena: " + konacno[i].Komentar.Ocena + "\nDatum: " + konacno[i].Komentar.DatumObjave + "</textarea ></td >");
                                                }

                                                s += ("<td>" + vratiStatusVoznje(konacno[i].StatusVoznje) + "</td></tr>");


                                            }

                                            s += '</table>';
                                            if (prvi == "da") {
                                                $('#glavni2').append(s);
                                                prvi = "ne";
                                            } else {
                                                // $('.voznje').hide();
                                                $('.voznje').replaceWith(s);
                                            }
                                        } else {
                                            alert("Sa prezimenom " + `${$('#prezimeVozacaPretraga').val()}` + " nije pronadjena ni jedna vožnja!");
                                            $(location).attr('href', 'main.html');
                                        }
                                    }
                                })
                                } else if (slucaj == 3) {
                                for (var i = 0; i < dataV.length; i++) {
                                    if (dataV[i].Prezime == `${$('#prezimeVozacaPretraga').val()}` && dataV[i].Ime == `${$('#imeVozacaPretraga').val()}`) {
                                        niz.push(dataV[i].KorisnickoIme);
                                    }
                                }

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                        let konacno = uporedi(niz, data);

                                        if (konacno.length > 0) {
                                            for (let i = 0; i < konacno.length; i++) {

                                                s += ("<tr><td>" + konacno[i].IdVoznje + "</td><td>" + konacno[i].DatumVreme + "</td>");

                                                if (konacno[i].Musterija == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Musterija + '</td>');
                                                }

                                                if (konacno[i].Vozac == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Vozac + '</td>');
                                                }

                                                s += ('<td>' + konacno[i].Lokacija.Adresa.UlicaBroj + ", " + konacno[i].Lokacija.Adresa.NaseljenoMesto + " " + konacno[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                                switch (konacno[i].Automobil) {
                                                    case 0:
                                                        s += "Putnički";
                                                        break;
                                                    case 1:
                                                        s += "Kombi";
                                                        break;
                                                    case 2:
                                                        s += "Svejedno";
                                                }

                                                if (konacno[i].Odrediste.Adresa.UlicaBroj == "") {
                                                    s += ("</td><td>/" + "</td>");
                                                }
                                                else {
                                                    s += ("</td><td>" + konacno[i].Odrediste.Adresa.UlicaBroj + ", " + konacno[i].Odrediste.Adresa.NaseljenoMesto + " " + konacno[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                                }

                                                if (konacno[i].Iznos != "0") {
                                                    s += ("<td>" + konacno[i].Iznos + "</td>");
                                                } else {
                                                    s += ("<td>/</td>");
                                                }

                                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                                if (konacno[i].Komentar.Opis == "") {
                                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                                } else {
                                                    s += ("Korisnicko ime: " + konacno[i].Komentar.KorisnickoIme + "\n\nOpis: " + konacno[i].Komentar.Opis + "\n\nOcena: " + konacno[i].Komentar.Ocena + "\nDatum: " + konacno[i].Komentar.DatumObjave + "</textarea ></td >");
                                                }

                                                s += ("<td>" + vratiStatusVoznje(konacno[i].StatusVoznje) + "</td></tr>");


                                            }

                                            s += '</table>';
                                            if (prvi == "da") {
                                                $('#glavni2').append(s);
                                                prvi = "ne";
                                            } else {
                                                // $('.voznje').hide();
                                                $('.voznje').replaceWith(s);
                                            }
                                        } else {
                                            alert("Sa imenom " + `${$('#imeVozacaPretraga').val()}` + " i prezimenom " + `${$('#prezimeVozacaPretraga').val()}`+" nije pronadjena ni jedna vožnja!");
                                            $(location).attr('href', 'main.html');
                                        }
                                    }
                                })
                                }
                        } else {
                            alert("Nema vozača u sistemu!");
                            $(location).attr('href', 'main.html');
                        }
                    }
                })
            })


            //pretraga musterije

            let prviMusterija;
            $('#pretragaMusterija').click(function () {
                let s = '';
                prviMusterija = "da";

                s += '<div style="position:relative;"><table style="position:absolute;margin-left:50%;margin-top:60px;margin-right:-50%;transform: translate(-50%, -50%)"><tr><th colspan="3" ><h3>Ovde možete izvršiti pretragu vožnji</h3></th></tr>';
                s += '<tr><td  data-balloon="Neki od parametara može ostati prazan!" data-balloon-pos="down" ><input type="text" name="imeMusterijePretraga" id="imeMusterijePretraga" placeholder="Ime mušterije" style="margin:5px"/></td><td  data-balloon="Neki od parametara može ostati prazan!" data-balloon-pos="down" ><input type="text" name="prezimeMusterijePretraga" id="prezimeMusterijePretraga" placeholder="Prezime mušterije" style="margin:5px"/></td>';
                s += '<td colspan="2" align="right" data-balloon="Izvrši pretragu!" data-balloon-pos="down"><input type="button" name="pretraziMusteriju" id="pretraziMusteriju" value="Traži" style="margin:5px" /></td></tr>';
                s += '</table></div>';


                $('#glavni2').hide();
                $('#glavni2').html(s);
                $('#glavni2').fadeIn(500);

            })

            $('#glavni2').on('click', '#pretraziMusteriju', function () {
                let s = '';
                s += '<div>';
                let niz = [];

                let slucaj;


                if (`${$('#imeMusterijePretraga').val()}` == "" && `${$('#prezimeMusterijePretraga').val()}` == "") {
                    slucaj = 0;
                } else if (`${$('#imeMusterijePretraga').val()}` != "" && `${$('#prezimeMusterijePretraga').val()}` == "") {
                    //punim niz svim Korisnickim Imenima koja su od ovog imena
                    slucaj = 1;
                } else if (`${$('#imeMusterijePretraga').val()}` == "" && `${$('#prezimeMusterijePretraga').val()}` != "") {
                    //punim niz svim Korisnickim Imenima koja su od ovog prezimena
                    slucaj = 2;
                } else if (`${$('#imeMusterijePretraga').val()}` != "" && `${$('#prezimeMusterijePretraga').val()}` != "") {
                    //punim niz svim Korisnickim Imenima koja su od ovog prezimena i imena
                    slucaj = 3;
                }


                $.ajax({
                    type: 'GET',
                    url: '/api/Registration',
                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (dataV) {
                        if (dataV.length > 0) {
                            if (slucaj == 0) {
                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10" data-balloon="Kako niste odabrali parametre, vraćamo vam celu listu!" data-balloon-pos="up"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';


                                        for (let i = 0; i < data.length; i++) {
                                            s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                            if (data[i].Musterija == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Musterija + '</td>');
                                            }

                                            if (data[i].Vozac == "") {
                                                s += '<td>/</td>';
                                            } else {
                                                s += ('<td>' + data[i].Vozac + '</td>');
                                            }

                                            s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                            switch (data[i].Automobil) {
                                                case 0:
                                                    s += "Putnički";
                                                    break;
                                                case 1:
                                                    s += "Kombi";
                                                    break;
                                                case 2:
                                                    s += "Svejedno";
                                            }

                                            if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                                s += ("</td><td>/" + "</td>");
                                            }
                                            else {
                                                s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                            }

                                            if (data[i].Iznos != "0") {
                                                s += ("<td>" + data[i].Iznos + "</td>");
                                            } else {
                                                s += ("<td>/</td>");
                                            }

                                            s += ('<td><textarea rows="5" cols="30" disabled>');

                                            if (data[i].Komentar.Opis == "") {
                                                s += ("Komentar nije dodat!" + "</textarea ></td >");
                                            } else {
                                                s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                            }

                                            s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td> </tr>");


                                        }
                                        s += '</table>';
                                        if (prviMusterija == "da") {
                                            $('#glavni2').append(s);
                                            prviMusterija = "ne";
                                        } else {
                                            $('.voznje').replaceWith(s);
                                        }
                                    }
                                })

                            } else if (slucaj == 1) {
                                for (var i = 0; i < dataV.length; i++) {
                                    if (dataV[i].Ime == `${$('#imeMusterijePretraga').val()}`) {
                                        niz.push(dataV[i].KorisnickoIme);
                                    }
                                }

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                        let konacno = uporediMusterija(niz, data);

                                        if (konacno.length > 0) {
                                            for (let i = 0; i < konacno.length; i++) {

                                                s += ("<tr><td>" + konacno[i].IdVoznje + "</td><td>" + konacno[i].DatumVreme + "</td>");

                                                if (konacno[i].Musterija == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Musterija + '</td>');
                                                }

                                                if (konacno[i].Vozac == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Vozac + '</td>');
                                                }

                                                s += ('<td>' + konacno[i].Lokacija.Adresa.UlicaBroj + ", " + konacno[i].Lokacija.Adresa.NaseljenoMesto + " " + konacno[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                                switch (konacno[i].Automobil) {
                                                    case 0:
                                                        s += "Putnički";
                                                        break;
                                                    case 1:
                                                        s += "Kombi";
                                                        break;
                                                    case 2:
                                                        s += "Svejedno";
                                                }

                                                if (konacno[i].Odrediste.Adresa.UlicaBroj == "") {
                                                    s += ("</td><td>/" + "</td>");
                                                }
                                                else {
                                                    s += ("</td><td>" + konacno[i].Odrediste.Adresa.UlicaBroj + ", " + konacno[i].Odrediste.Adresa.NaseljenoMesto + " " + konacno[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                                }

                                                if (konacno[i].Iznos != "0") {
                                                    s += ("<td>" + konacno[i].Iznos + "</td>");
                                                } else {
                                                    s += ("<td>/</td>");
                                                }

                                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                                if (konacno[i].Komentar.Opis == "") {
                                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                                } else {
                                                    s += ("Korisnicko ime: " + konacno[i].Komentar.KorisnickoIme + "\n\nOpis: " + konacno[i].Komentar.Opis + "\n\nOcena: " + konacno[i].Komentar.Ocena + "\nDatum: " + konacno[i].Komentar.DatumObjave + "</textarea ></td >");
                                                }

                                                s += ("<td>" + vratiStatusVoznje(konacno[i].StatusVoznje) + "</td></tr>");


                                            }

                                            s += '</table>';
                                            if (prviMusterija == "da") {
                                                $('#glavni2').append(s);
                                                prviMusterija = "ne";
                                            } else {
                                                // $('.voznje').hide();
                                                $('.voznje').replaceWith(s);
                                            }
                                        } else {
                                            alert("Sa imenom " + `${$('#imeMusterijePretraga').val()}` + " nije pronadjena ni jedna vožnja!");
                                            $(location).attr('href', 'main.html');
                                        }
                                    }
                                })


                            } else if (slucaj == 2) {
                                for (var i = 0; i < dataV.length; i++) {
                                    if (dataV[i].Prezime == `${$('#prezimeMusterijePretraga').val()}`) {
                                        niz.push(dataV[i].KorisnickoIme);
                                    }
                                }

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                        let konacno = uporediMusterija(niz, data);

                                        if (konacno.length > 0) {
                                            for (let i = 0; i < konacno.length; i++) {

                                                s += ("<tr><td>" + konacno[i].IdVoznje + "</td><td>" + konacno[i].DatumVreme + "</td>");

                                                if (konacno[i].Musterija == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Musterija + '</td>');
                                                }

                                                if (konacno[i].Vozac == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Vozac + '</td>');
                                                }

                                                s += ('<td>' + konacno[i].Lokacija.Adresa.UlicaBroj + ", " + konacno[i].Lokacija.Adresa.NaseljenoMesto + " " + konacno[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                                switch (konacno[i].Automobil) {
                                                    case 0:
                                                        s += "Putnički";
                                                        break;
                                                    case 1:
                                                        s += "Kombi";
                                                        break;
                                                    case 2:
                                                        s += "Svejedno";
                                                }

                                                if (konacno[i].Odrediste.Adresa.UlicaBroj == "") {
                                                    s += ("</td><td>/" + "</td>");
                                                }
                                                else {
                                                    s += ("</td><td>" + konacno[i].Odrediste.Adresa.UlicaBroj + ", " + konacno[i].Odrediste.Adresa.NaseljenoMesto + " " + konacno[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                                }

                                                if (konacno[i].Iznos != "0") {
                                                    s += ("<td>" + konacno[i].Iznos + "</td>");
                                                } else {
                                                    s += ("<td>/</td>");
                                                }

                                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                                if (konacno[i].Komentar.Opis == "") {
                                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                                } else {
                                                    s += ("Korisnicko ime: " + konacno[i].Komentar.KorisnickoIme + "\n\nOpis: " + konacno[i].Komentar.Opis + "\n\nOcena: " + konacno[i].Komentar.Ocena + "\nDatum: " + konacno[i].Komentar.DatumObjave + "</textarea ></td >");
                                                }

                                                s += ("<td>" + vratiStatusVoznje(konacno[i].StatusVoznje) + "</td></tr>");


                                            }

                                            s += '</table>';
                                            if (prviMusterija == "da") {
                                                $('#glavni2').append(s);
                                                prviMusterija = "ne";
                                            } else {
                                                // $('.voznje').hide();
                                                $('.voznje').replaceWith(s);
                                            }
                                        } else {
                                            alert("Sa prezimenom " + `${$('#prezimeMusterijePretraga').val()}` + " nije pronadjena ni jedna vožnja!");
                                            $(location).attr('href', 'main.html');
                                        }
                                    }
                                })
                            } else if (slucaj == 3) {
                                for (var i = 0; i < dataV.length; i++) {
                                    if (dataV[i].Prezime == `${$('#prezimeMusterijePretraga').val()}` && dataV[i].Ime == `${$('#imeMusterijePretraga').val()}`) {
                                        niz.push(dataV[i].KorisnickoIme);
                                    }
                                }

                                $.ajax({
                                    type: 'GET',
                                    url: '/api/Voznja',
                                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                                    contentType: 'application/json;charset=utf-8',
                                    dataType: 'json',
                                    success: function (data) {
                                        let s = '';
                                        s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                        s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                        s += '<tr><th>Id vožnje</th><th>Datum</th><th>Mušterija</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                        let konacno = uporediMusterija(niz, data);

                                        if (konacno.length > 0) {
                                            for (let i = 0; i < konacno.length; i++) {

                                                s += ("<tr><td>" + konacno[i].IdVoznje + "</td><td>" + konacno[i].DatumVreme + "</td>");

                                                if (konacno[i].Musterija == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Musterija + '</td>');
                                                }

                                                if (konacno[i].Vozac == "") {
                                                    s += '<td>/</td>';
                                                } else {
                                                    s += ('<td>' + konacno[i].Vozac + '</td>');
                                                }

                                                s += ('<td>' + konacno[i].Lokacija.Adresa.UlicaBroj + ", " + konacno[i].Lokacija.Adresa.NaseljenoMesto + " " + konacno[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                                switch (konacno[i].Automobil) {
                                                    case 0:
                                                        s += "Putnički";
                                                        break;
                                                    case 1:
                                                        s += "Kombi";
                                                        break;
                                                    case 2:
                                                        s += "Svejedno";
                                                }

                                                if (konacno[i].Odrediste.Adresa.UlicaBroj == "") {
                                                    s += ("</td><td>/" + "</td>");
                                                }
                                                else {
                                                    s += ("</td><td>" + konacno[i].Odrediste.Adresa.UlicaBroj + ", " + konacno[i].Odrediste.Adresa.NaseljenoMesto + " " + konacno[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                                }

                                                if (konacno[i].Iznos != "0") {
                                                    s += ("<td>" + konacno[i].Iznos + "</td>");
                                                } else {
                                                    s += ("<td>/</td>");
                                                }

                                                s += ('<td><textarea rows="5" cols="30" disabled>');

                                                if (konacno[i].Komentar.Opis == "") {
                                                    s += ("Komentar nije dodat!" + "</textarea ></td >");
                                                } else {
                                                    s += ("Korisnicko ime: " + konacno[i].Komentar.KorisnickoIme + "\n\nOpis: " + konacno[i].Komentar.Opis + "\n\nOcena: " + konacno[i].Komentar.Ocena + "\nDatum: " + konacno[i].Komentar.DatumObjave + "</textarea ></td >");
                                                }

                                                s += ("<td>" + vratiStatusVoznje(konacno[i].StatusVoznje) + "</td></tr>");


                                            }

                                            s += '</table>';
                                            if (prviMusterija == "da") {
                                                $('#glavni2').append(s);
                                                prviMusterija = "ne";
                                            } else {
                                                // $('.voznje').hide();
                                                $('.voznje').replaceWith(s);
                                            }
                                        } else {
                                            alert("Sa imenom " + `${$('#imeMusterijePretraga').val()}` + " i prezimenom " + `${$('#prezimeMusterijePretraga').val()}` + " nije pronadjena ni jedna vožnja!");
                                            $(location).attr('href', 'main.html');
                                        }
                                    }
                                })
                            }
                        } else {
                            alert("Nema mušterija u sistemu!");
                            $(location).attr('href', 'main.html');
                        }
                    }
                })
            })
            //KRAJ OVOGA ZA PRETRAGU U DISPECERU


            //PRETRAGA U KLIJENTU

            let prviProlaz;
            $('#pretragaKorisnik').click(function () {
                let s = '';
                prviProlaz = "da";

                s += '<div style="position:relative;" ><table  style="position:absolute;margin-left:50%;margin-top:60px;margin-right:-50%;transform: translate(-50%, -50%);width:60%;"><tr><th colspan="4" ><h3>Ovde možete izvršiti pretragu vožnji</h3></th></tr>';
                s += '<tr><td  data-balloon="Datum od kog želite pretragu!" data-balloon-pos="down" style="width:30%;"><input type="date" name="datumPretragaOd" id="datumPretragaOd" placeholder="Datum OD" style="margin:5px;width:80%;"/></td><td   style="width:30%;"><input type="number" min="0" max="5" name="ocenaPretragaOd" id="ocenaPretragaOd" placeholder="Ocena OD" style="margin:5px;width:80%;"/></td><td style="width:30%;"><input type="number" name="cenaPretragaOd" id="cenaPretragaOd" placeholder="Cena OD" style="margin:5px;width:80%;"/></td><td rawspan="3"></td></tr>';
                s += '<tr><td  data-balloon="Datum do kog želite pretragu!" data-balloon-pos="down" style="width:30%;"><input type="date" name="datumPretragaDo" id="datumPretragaDo" placeholder="Datum DO" style="margin:5px;width:80%;"/></td><td  style="width:30%;"><input type="number" min="0" max="5" name="ocenaPretragaDo" id="ocenaPretragaDo" placeholder="Ocena DO" style="margin:5px;width:80%;"/></td><td style="width:30%;"><input type="number" name="cenaPretragaDo" id="cenaPretragaDo" placeholder="Cena DO" style="margin:5px;width:80%;"/></td><td data-balloon="Ne moraju biti popunjeni svi parametri!" data-balloon-pos="down"><input type="button" name="traziKorisnik" id="traziKorisnik" value="Traži"/></td></tr>';
                s += '</table></div>';


                $('#glavni').hide();
                $('#glavni').html(s);
                $('#glavni').fadeIn(500);
            })

            $('#glavni').on('click', '#traziKorisnik', function () {
                let s = '';
                s += '<div>';
                let niz = [];
                let niz2 = [];
                let niz3 = [];
                let nizSve = [];

                let datOd = `${$('#datumPretragaOd').val()}`;
                let datDo = `${$('#datumPretragaDo').val()}`;
                let ocenaOd = `${$('#ocenaPretragaOd').val()}`;
                let ocenaDo = `${$('#ocenaPretragaDo').val()}`;
                let cenaOd = `${$('#cenaPretragaOd').val()}`;
                let cenaDo = `${$('#cenaPretragaDo').val()}`;

                if (`${$('#datumPretragaOd').val()}` == "" && `${$('#datumPretragaDo').val()}` == "" && `${$('#ocenaPretragaOd').val()}` == "" && `${$('#ocenaPretragaDo').val()}` == "" && `${$('#cenaPretragaOd').val()}` == "" && `${$('#cenaPretragaDo').val()}` == "") {
                    alert("Morate uneti bar 1 parametar po kome se vrši pretraga!");
                } else {
                    if (`${$('#datumPretragaOd').val()}` != "" && `${$('#datumPretragaDo').val()}` == "") {
                        datOd = `${$('#datumPretragaOd').val()}`;
                        datDo = '2025-01-01';
                    } else if (`${$('#datumPretragaOd').val()}` == "" && `${$('#datumPretragaDo').val()}` != "") {
                        datDo = `${$('#datumPretragaDo').val()}`;
                        datOd = '2010-01-01';
                    }

                    if (`${$('#ocenaPretragaOd').val()}` != "" && `${$('#ocenaPretragaDo').val()}` == "") {
                        ocenaOd = `${$('#ocenaPretragaOd').val()}`;
                        ocenaDo = '5';
                    } else if (`${$('#ocenaPretragaOd').val()}` == "" && `${$('#ocenaPretragaDo').val()}` != "") {
                        ocenaDo = `${$('#ocenaPretragaDo').val()}`;
                        ocenaOd = '0';
                    }

                    if (`${$('#cenaPretragaOd').val()}` != "" && `${$('#cenaPretragaDo').val()}` == "") {
                        cenaOd = `${$('#cenaPretragaOd').val()}`;
                        cenaDo = '40000';
                    } else if (`${$('#cenaPretragaOd').val()}` == "" && `${$('#cenaPretragaDo').val()}` != "") {
                        cenaDo = `${$('#cenaPretragaDo').val()}`;
                        cenaOd = '0';
                    }

                    $.ajax({
                        type: 'GET',
                        url: '/api/Voznja',
                        //data: JSON.stringify(KomentarOtkazaneVoznja),
                        contentType: 'application/json;charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data.length > 0) {
                                for (var i = 0; i < data.length; i++) {
                                    if (data[i].Musterija == `${localStorage.getItem("Ulogovan")}`) {
                                        nizSve.push(data[i]);
                                    }
                                }

                                if (nizSve.length != 0) {
                                    for (var i = 0; i < nizSve.length; i++) {

                                        if (`${$('#datumPretragaOd').val()}` == "" && `${$('#datumPretragaDo').val()}` == "") {
                                            niz.push(nizSve[i]);
                                        } else {
                                            if (new Date(datOd) <= new Date(nizSve[i].DatumVreme.substring(0, 10)) && new Date(datDo) >= new Date(nizSve[i].DatumVreme.substring(0, 10))) {
                                                niz.push(nizSve[i]);
                                            }
                                        }
                                    }

                                    if (niz.length != 0) {
                                        for (var i = 0; i < niz.length; i++) {
                                            if (`${$('#ocenaPretragaOd').val()}` == "" && `${$('#ocenaPretragaDo').val()}` == "") {
                                                niz2.push(niz[i]);
                                            } else {
                                                if (niz[i].Komentar.Ocena != "") {
                                                    if (ocenaOd <= niz[i].Komentar.Ocena && ocenaDo >= niz[i].Komentar.Ocena) {
                                                        niz2.push(niz[i]);
                                                    }
                                                }
                                            }
                                        }

                                        if (niz2.length != 0) {
                                            for (var i = 0; i < niz2.length; i++) {
                                                if (`${$('#cenaPretragaOd').val()}` == "" && `${$('#cenaPretragaDo').val()}` == "") {
                                                    niz3.push(niz2[i]);
                                                } else {
                                                    if (niz2[i].Iznos != "") {
                                                        if (cenaOd <= niz2[i].Iznos && cenaDo >= niz2[i].Iznos) {
                                                            niz3.push(niz2[i]);
                                                        }
                                                    }
                                                }
                                            }

                                            if (niz3.length > 0) {

                                                let s = '';
                                                s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                                s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat pretrage</b></h3></th></tr>';
                                                s += '<tr><th>Id vožnje</th><th>Datum</th><th>Dispečer</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';


                                                for (let i = 0; i < niz3.length; i++) {

                                                    s += ("<tr><td>" + niz3[i].IdVoznje + "</td><td>" + niz3[i].DatumVreme + "</td>");

                                                    if (niz3[i].Dispecer == "") {
                                                        s += '<td>/</td>';
                                                    } else {
                                                        s += ('<td>' + niz3[i].Dispecer + '</td>');
                                                    }

                                                    if (niz3[i].Vozac == "") {
                                                        s += '<td>/</td>';
                                                    } else {
                                                        s += ('<td>' + niz3[i].Vozac + '</td>');
                                                    }

                                                    s += ('<td>' + niz3[i].Lokacija.Adresa.UlicaBroj + ", " + niz3[i].Lokacija.Adresa.NaseljenoMesto + " " + niz3[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                                    switch (niz3[i].Automobil) {
                                                        case 0:
                                                            s += "Putnički";
                                                            break;
                                                        case 1:
                                                            s += "Kombi";
                                                            break;
                                                        case 2:
                                                            s += "Svejedno";
                                                    }

                                                    if (niz3[i].Odrediste.Adresa.UlicaBroj == "") {
                                                        s += ("</td><td>/" + "</td>");
                                                    }
                                                    else {
                                                        s += ("</td><td>" + niz3[i].Odrediste.Adresa.UlicaBroj + ", " + niz3[i].Odrediste.Adresa.NaseljenoMesto + " " + niz3[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                                    }

                                                    if (niz3[i].Iznos != "0") {
                                                        s += ("<td>" + niz3[i].Iznos + "</td>");
                                                    } else {
                                                        s += ("<td>/</td>");
                                                    }

                                                    s += ('<td><textarea rows="5" cols="30" disabled>');

                                                    if (niz3[i].Komentar.Opis == "") {
                                                        s += ("Komentar nije dodat!" + "</textarea ></td >");
                                                    } else {
                                                        s += ("Korisnicko ime: " + niz3[i].Komentar.KorisnickoIme + "\n\nOpis: " + niz3[i].Komentar.Opis + "\n\nOcena: " + niz3[i].Komentar.Ocena + "\nDatum: " + niz3[i].Komentar.DatumObjave + "</textarea ></td >");
                                                    }

                                                    s += ("<td>" + vratiStatusVoznje(niz3[i].StatusVoznje) + "</td></tr>");
                                                }
                                                s += '</table>';

                                                if (prviProlaz == "da") {
                                                    $('#glavni').append(s);
                                                    prviProlaz = "ne";
                                                } else {
                                                    // $('.voznje').hide();
                                                    $('.voznje').replaceWith(s);
                                                }
                                               // $('#glavni').append(s);
                                            }
                                            else {
                                                alert("Nemate voznje zadate ovom pretragom!");
                                            }
                                        } else {
                                            alert("Za dat interval ocena, ni jedna voznja se ne uklapa!");
                                        }

                                    } else {
                                        alert("Za odabrano vreme, ni jedna voznja se ne moze pronaci!");
                                    }
                                } else {
                                    alert("Korisnik ne poseduje ni jednu voznju!");
                                }
                            } else {
                                alert("Nema vožnji u sistemu!");
                            }


                        }
                    })

                }

            })

            //KRAJ PRETRAGA U KLIJENTU


            //FILTER U KLIJENTU

            let prviFilter;
            $('#filtrirajVoznje').click(function(){

                let s = '';
                prviFilter = "da";

                s += '<div style="position:relative;"><table style="position:absolute;margin-left:50%;margin-top:60px;margin-right:-50%;transform: translate(-50%, -50%);"><tr><th colspan="2" ><h3>Ovde možete izvršiti filtriranje po statusu vožnje</h3></th></tr>';
                s += '<tr><td align="center"><select name="filterTip" id="filterTip"><option value="Kreirana">Kreirana</option><option value="Formirana">Formirana</option><option value="Obradjena">Obradjena</option><option value="Prihvaćena">Prihvaćena</option><option value="Otkazana">Otkazana</option><option value="Neuspešna">Neušpesna</option><option value="Uspešna">Uspešna</option></select></td><td><input type="button" name="filtriranje" id="filtriranje" value="Filtriraj"/></td></tr>';
                s += '</table></div>';

                $('#glavni').html(s);
                $('#glavni').fadeIn(500);

            })

            $('#glavni').on('click', '#filtriranje', function () {
                let data = [];
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (dataV) {
                        if (dataV.length != 0) {

                            for (var i = 0; i < dataV.length; i++) {
                                if (vratiStatusVoznje(dataV[i].StatusVoznje) == `${$('#filterTip').val()}` && dataV[i].Musterija == `${localStorage.getItem("Ulogovan")}`) 
                                    {
                                        data.push(dataV[i]);
                                    }
                            }

                            if (data.length > 0) {
                                let s = '';
                                s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:100px;">';
                                s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat filtriranja</b></h3></th></tr>';
                                s += '<tr><th>Id vožnje</th><th>Datum</th><th>Dispečer</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                for (var i = 0; i < data.length; i++) {

                                    s += ("<tr><td>" + data[i].IdVoznje + "</td><td>" + data[i].DatumVreme + "</td>");

                                    if (data[i].Dispecer == "") {
                                        s += '<td>/</td>';
                                    } else {
                                        s += ('<td>' + data[i].Dispecer + '</td>');
                                    }

                                    if (data[i].Vozac == "") {
                                        s += '<td>/</td>';
                                    } else {
                                        s += ('<td>' + data[i].Vozac + '</td>');
                                    }

                                    s += ('<td>' + data[i].Lokacija.Adresa.UlicaBroj + ", " + data[i].Lokacija.Adresa.NaseljenoMesto + " " + data[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                    switch (data[i].Automobil) {
                                        case 0:
                                            s += "Putnički";
                                            break;
                                        case 1:
                                            s += "Kombi";
                                            break;
                                        case 2:
                                            s += "Svejedno";
                                    }

                                    if (data[i].Odrediste.Adresa.UlicaBroj == "") {
                                        s += ("</td><td>/" + "</td>");
                                    }
                                    else {
                                        s += ("</td><td>" + data[i].Odrediste.Adresa.UlicaBroj + ", " + data[i].Odrediste.Adresa.NaseljenoMesto + " " + data[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                    }

                                    if (data[i].Iznos != "0") {
                                        s += ("<td>" + data[i].Iznos + "</td>");
                                    } else {
                                        s += ("<td>/</td>");
                                    }

                                    s += ('<td><textarea rows="5" cols="30" disabled>');

                                    if (data[i].Komentar.Opis == "") {
                                        s += ("Komentar nije dodat!" + "</textarea ></td >");
                                    } else {
                                        s += ("Korisnicko ime: " + data[i].Komentar.KorisnickoIme + "\n\nOpis: " + data[i].Komentar.Opis + "\n\nOcena: " + data[i].Komentar.Ocena + "\nDatum: " + data[i].Komentar.DatumObjave + "</textarea ></td >");
                                    }

                                    s += ("<td>" + vratiStatusVoznje(data[i].StatusVoznje) + "</td></tr>");

                                }
                                s += '</table>';

                                if (prviFilter == "da") {
                                    $('#glavni').append(s);
                                    prviFilter = "ne";
                                } else {
                                    // $('.voznje').hide();
                                    $('.voznje').replaceWith(s);
                                }

                            } else {
                                alert("Korisnik " + `${localStorage.getItem("Ulogovan")}`+", nema svojih vožnji!");
                            }
                            
                        } else {
                            alert("Nema voznji u sistemu!");
                        }
                    }
                })

            })

            //KRAJ FILTERA U KLIJENTU


            //SORTIRAJ U KLIJENTU

            $('#sortirajDatum').click(function () {
                let zasortiranje = [];
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data.length > 0) {
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].Musterija == `${localStorage.getItem("Ulogovan")}`) {
                                    zasortiranje.push(data[i]);
                                }
                            }

                            zasortiranje.sort(function (a, b) {
                                return new Date(b.DatumVreme) - new Date(a.DatumVreme);
                            })

                            if (zasortiranje.length > 0) {
                                let s = '';
                                s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:0px;">';
                                s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat sortiranja po datumu</b></h3></th></tr>';
                                s += '<tr><th>Id vožnje</th><th>Datum</th><th>Dispečer</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                for (var i = 0; i < zasortiranje.length; i++) {
                                    s += ("<tr><td>" + zasortiranje[i].IdVoznje + "</td><td>" + zasortiranje[i].DatumVreme + "</td>");

                                    if (zasortiranje[i].Dispecer == "") {
                                        s += '<td>/</td>';
                                    } else {
                                        s += ('<td>' + zasortiranje[i].Dispecer + '</td>');
                                    }

                                    if (zasortiranje[i].Vozac == "") {
                                        s += '<td>/</td>';
                                    } else {
                                        s += ('<td>' + zasortiranje[i].Vozac + '</td>');
                                    }

                                    s += ('<td>' + zasortiranje[i].Lokacija.Adresa.UlicaBroj + ", " + zasortiranje[i].Lokacija.Adresa.NaseljenoMesto + " " + zasortiranje[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                    switch (zasortiranje[i].Automobil) {
                                        case 0:
                                            s += "Putnički";
                                            break;
                                        case 1:
                                            s += "Kombi";
                                            break;
                                        case 2:
                                            s += "Svejedno";
                                    }

                                    if (zasortiranje[i].Odrediste.Adresa.UlicaBroj == "") {
                                        s += ("</td><td>/" + "</td>");
                                    }
                                    else {
                                        s += ("</td><td>" + zasortiranje[i].Odrediste.Adresa.UlicaBroj + ", " + zasortiranje[i].Odrediste.Adresa.NaseljenoMesto + " " + zasortiranje[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                    }

                                    if (zasortiranje[i].Iznos != "0") {
                                        s += ("<td>" + zasortiranje[i].Iznos + "</td>");
                                    } else {
                                        s += ("<td>/</td>");
                                    }

                                    s += ('<td><textarea rows="5" cols="30" disabled>');

                                    if (zasortiranje[i].Komentar.Opis == "") {
                                        s += ("Komentar nije dodat!" + "</textarea ></td >");
                                    } else {
                                        s += ("Korisnicko ime: " + zasortiranje[i].Komentar.KorisnickoIme + "\n\nOpis: " + zasortiranje[i].Komentar.Opis + "\n\nOcena: " + zasortiranje[i].Komentar.Ocena + "\nDatum: " + zasortiranje[i].Komentar.DatumObjave + "</textarea ></td >");
                                    }

                                    s += ("<td>" + vratiStatusVoznje(zasortiranje[i].StatusVoznje) + "</td></tr>");
                                }
                                s += '</table>';

                                $('#glavni').html(s);
                            } else {
                                alert("Korisnik " + `${localStorage.getItem("Ulogovan")}` + ", nema registrovanih vožnji!");
                            }

                        } else {
                            alert("U sistemu ne postoji ni jedna vožnja!");
                        }
                    }
                })
            })

            $('#sortirajOcena').click(function () {
                let zasortiranje = [];
                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    //data: JSON.stringify(KomentarOtkazaneVoznja),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data.length > 0) {
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].Musterija == `${localStorage.getItem("Ulogovan")}` && data[i].Komentar.Ocena != "") {
                                    zasortiranje.push(data[i]);
                                }
                            }

                            zasortiranje.sort(function (a, b) {
                                return b.Komentar.Ocena - a.Komentar.Ocena;
                            })

                            //cisto smestam one bez ocene na kraj tabele jer onako
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].Musterija == `${localStorage.getItem("Ulogovan")}` && data[i].Komentar.Ocena == "") {
                                    zasortiranje.push(data[i]);
                                }
                            }

                            if (zasortiranje.length > 0) {
                                let s = '';
                                s += '<div class="voznje" style="font-size:14px;position:absolute;margin-top:0px;">';
                                s += '<table border=1 class="voznje boja"><tr><th colspan="10"><h3><b>Rezultat sortiranja po ocenama</b></h3></th></tr>';
                                s += '<tr><th>Id vožnje</th><th>Datum</th><th>Dispečer</th><th>Vozač</th><th >Mesto polaska</th><th>Tip auta</th><th>Ordedište</th><th>Iznos</th><th>Komentar</th><th>Status vožnje</th></tr>';

                                for (var i = 0; i < zasortiranje.length; i++) {
                                    s += ("<tr><td>" + zasortiranje[i].IdVoznje + "</td><td>" + zasortiranje[i].DatumVreme + "</td>");

                                    if (zasortiranje[i].Dispecer == "") {
                                        s += '<td>/</td>';
                                    } else {
                                        s += ('<td>' + zasortiranje[i].Dispecer + '</td>');
                                    }

                                    if (zasortiranje[i].Vozac == "") {
                                        s += '<td>/</td>';
                                    } else {
                                        s += ('<td>' + zasortiranje[i].Vozac + '</td>');
                                    }

                                    s += ('<td>' + zasortiranje[i].Lokacija.Adresa.UlicaBroj + ", " + zasortiranje[i].Lokacija.Adresa.NaseljenoMesto + " " + zasortiranje[i].Lokacija.Adresa.PozivniBroj + "</td><td>");

                                    switch (zasortiranje[i].Automobil) {
                                        case 0:
                                            s += "Putnički";
                                            break;
                                        case 1:
                                            s += "Kombi";
                                            break;
                                        case 2:
                                            s += "Svejedno";
                                    }

                                    if (zasortiranje[i].Odrediste.Adresa.UlicaBroj == "") {
                                        s += ("</td><td>/" + "</td>");
                                    }
                                    else {
                                        s += ("</td><td>" + zasortiranje[i].Odrediste.Adresa.UlicaBroj + ", " + zasortiranje[i].Odrediste.Adresa.NaseljenoMesto + " " + zasortiranje[i].Odrediste.Adresa.PozivniBroj + "</td>");
                                    }

                                    if (zasortiranje[i].Iznos != "0") {
                                        s += ("<td>" + zasortiranje[i].Iznos + "</td>");
                                    } else {
                                        s += ("<td>/</td>");
                                    }

                                    s += ('<td><textarea rows="5" cols="30" disabled>');

                                    if (zasortiranje[i].Komentar.Opis == "") {
                                        s += ("Komentar nije dodat!" + "</textarea ></td >");
                                    } else {
                                        s += ("Korisnicko ime: " + zasortiranje[i].Komentar.KorisnickoIme + "\n\nOpis: " + zasortiranje[i].Komentar.Opis + "\n\nOcena: " + zasortiranje[i].Komentar.Ocena + "\nDatum: " + zasortiranje[i].Komentar.DatumObjave + "</textarea ></td >");
                                    }

                                    s += ("<td>" + vratiStatusVoznje(zasortiranje[i].StatusVoznje) + "</td></tr>");
                                }
                                s += '</table>';

                                $('#glavni').html(s);

                            } else {
                                alert("Korisnik " + `${localStorage.getItem("Ulogovan")}` +", trenutno ne poseduje vožnju!");
                            }
                        } else {
                            alert("Nema vožnji u sistemu!");
                        }
                    }
                })
            })

            //KRAJ SORTIRAJ U KLIJENTU

        })




    </script>
</head>
<body>
    <div id="korisnik">
        <nav class="nova">
            <div class="container-fluid">
                <div class="collapse navbar-collapse">
                    <div id="d1">
                        Gold TAXI
                    </div>

                    <div class="homeButton">
                        <button style="background-color:#ffd700;border:none;height:55px;width:auto" id="dugmeHome">
                            <i class="material-icons" style="font-size:xx-large;margin-top:8px" data-balloon="Sve moje vožnje!" data-balloon-pos="down">home</i>
                        </button>
                    </div>

                    <div class="dropdown">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <button style="background-color:#ffd700;border:none;height:55px;width:auto"><i class="material-icons" style="font-size:xx-large;margin-top:8px">person</i> </button>
                            </li>

                        </ul>
                        <div class="dropdown-content">
                            <a href="#" id="profil">Profil</a>
                            <a href="#" id="izmeni">Izmeni</a>
                            <a href="#" id="odjavi">Odjavi se</a>
                        </div>
                    </div>
                    <div style="margin-left:12px;position:relative;display:inline-block">
                        <button type="button" style="background-color:#ffd700;border:none;margin-top:-45px;font-size:22px;height:55px;" class="btn btn-default btn-sm" id="korisnikDodajVoznju" data-toggle="tooltip" title="Dodaj novu vožnju">
                            <span class="glyphicon glyphicon-plus"></span>
                        </button>
                    </div>
                    <div class="searchButtonK">
                        <button style="background-color:#ffd700;border:none;height:55px;width:auto" data-toggle="tooltip" title="Pretraži" id="pretragaKorisnik"><span class="glyphicon glyphicon-search"></span></button>
                    </div>
                    <div style="display:inline-block;position:absolute;margin-left:0px;">
                        <button style="background-color:#ffd700;border:none;height:55px;width:44px" data-toggle="tooltip" title="Filtriraj" id="filtrirajVoznje"><span class="glyphicon glyphicon-filter"></span></button>
                    </div>
                    <div class="dropdown" style="margin-left:45px;">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <button style="background-color:#ffd700;border:none;height:55px;width:44px" data-toggle="tooltip" title="Sortiraj" id="sortiranje"><span class="glyphicon glyphicon-sort-by-attributes-alt"></span></button>
                            </li>

                        </ul>
                        <div class="dropdown-content" >
                            <a href="#" id="sortirajDatum">Datum</a>
                            <a href="#" id="sortirajOcena">Ocena</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <img src="pozadinaSreten.jpg" id="soloPic" />
        <div id="glavni">
        </div>      
    </div>
    <div id="dispecer">
        <nav class="nova">
            <div class="container-fluid">
                <div class="collapse navbar-collapse">
                    <div id="d1d">
                        Gold TAXI
                    </div>
                    <div class="dropdown homeButtonD">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <button style="background-color:#ffd700;border:none;height:55px;width:auto" id="dugmeHomeD">
                                    <i class="material-icons" style="font-size:xx-large;margin-top:8px" data-toggle="tooltip" title="Moje vožnje">home</i>
                                </button>
                            </li>
                        </ul>
                        <div class="dropdown-content">
                            <a href="#" id="moje">Moje vožnje</a>
                            <a href="#" id="sve">Sve vožnje</a>
                            <a href="#" id="nacekanju">Vožnje na čekanju</a>
                        </div>
                        </div>
                        <div class="dropdown">
                            <ul class="nav navbar-nav navbar-right">
                                <li>
                                    <button style="background-color:#ffd700;border:none;height:55px;width:auto"><i class="material-icons" style="font-size:xx-large;margin-top:8px">person</i> </button>
                                </li>
                            </ul>
                            <div class="dropdown-content">
                                <a href="#" id="profild">Profil</a>
                                <a href="#" id="izmenid">Izmeni</a>
                                <a href="#" id="odjavid">Odjavi se</a>
                            </div>
                        </div>
                        <div class="dropdown addButton">
                            <ul class="nav navbar-nav navbar-right">
                                <li>
                                    <button type="button" style="background-color:#ffd700;height:55px;width:auto;border:none;font-size:22px" class="btn btn-default btn-sm" data-toggle="tooltip" title="Dodaj">
                                        <span class="glyphicon glyphicon-plus"></span>
                                    </button>
                                </li>
                            </ul>
                            <div class="dropdown-content">
                                <a href="#" id="nV">Vožnja</a>
                                <a href="#" id="novVozac">Vozač</a>
                            </div>
                        </div>
                        <div class="dropdown searchButton">
                            <ul class="nav navbar-nav navbar-right">
                                <li>
                                    <button style="background-color:#ffd700;border:none;height:55px;width:auto" data-toggle="tooltip" title="Pretraži"><span class="glyphicon glyphicon-search"></span></button>
                                </li>
                            </ul>
                            <div class="dropdown-content">
                                <a href="#" id="pretragaVozac">Vozač</a>
                                <a href="#" id="pretragaMusterija">Mušterija</a>
                            </div>
                        </div>
                    </div>
            </div>
        </nav>
        <img src="pozadinaSreten.jpg" id="soloPicd" />
        <div id="glavni2">
        </div>
    </div>
    <div id="vozac">
        <nav class="nova">
            <div class="container-fluid">
                <div class="collapse navbar-collapse">
                    <div id="d1v">
                        Gold TAXI
                    </div>
                    <div class="dropdown homeButtonD">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <button style="background-color:#ffd700;border:none;height:55px;width:auto" id="dugmeHomeV">
                                    <i class="material-icons" style="font-size:xx-large;margin-top:8px" data-toggle="tooltip" title="Moje vožnje">home</i>
                                </button>
                            </li>
                        </ul>
                        <div class="dropdown-content">
                            <a href="#" id="mojeVozac">Moje vožnje</a>
                            <a href="#" id="nacekanjuVozac">Vožnje na čekanju</a>
                        </div>
                </div>
                    <div class="dropdown">
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <button style="background-color:#ffd700;border:none;height:55px;width:auto"><i class="material-icons" style="font-size:xx-large;margin-top:8px">person</i> </button>
                            </li>
                        </ul>
                        <div class="dropdown-content">
                            <a href="#" id="profilv">Profil</a>
                            <a href="#" id="izmeniv">Izmeni</a>
                            <a href="#" id="odjaviv">Odjavi se</a>
                        </div>
                    </div>
                    <div class="positionButton">
                        <button style="background-color:#ffd700;border:none;height:55px;width:auto" data-balloon="Izmeni svoju Lokaciju!" data-balloon-pos="down" id="menjamLokaciju">
                            <i class="material-icons" style="font-size:xx-large;">place</i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        <img src="pozadinaSreten.jpg" id="soloPicv" />
        <div id="glavni3">

        </div>
    </div>
</body>
</html>
